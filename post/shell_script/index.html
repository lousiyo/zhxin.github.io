<!doctype html><html lang=zh dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Shell编程基础 | zhxin</title>
<meta name=keywords content="shell">
<meta name=description content="变量 脚本开头使用#!/bin/bash指定要使用的shell,shell会通过PATH环境变量来查找脚本中使用的命令，可以使用echo $PATH来看下脚本会在哪些目录下查找命令，如果脚本中执行的命令没有在PATH环境变量中，也可以通过绝对或相对路径来引用.
在脚本中可以使用shell维护的环境变量也可以定义和使用自己的用户变量.
赋值等号两边不能存在空格
  环境变量：
可以使用set命令查看当前环境变量列表,例如$HOME、$HOSTNAME、$USER等;
  用户变量：
由字母数字下划线组成，长度不超过二十，区分大小写，变量、等号、值之间不能有空格，在shell脚本结束时会被删除掉，使用美元符号引用，例如name=&#34;test&#34;。
使用用户变量保存命令执行结果：testing=$(date)
  特殊参数变量
   参数 描述     $0 $1 $2 入参   $# 参数个数   $* 入参列表，将所有参数当作单个参数   $@ 入参列表，单独处理每个参      重定向输入输出 输出重定向: > 追加：>>
输入重定向: < 在脚本中使用< > 需要进行转义\< \>
内联输入重定向：
command << marker content marker # 例如：  wc -l <<EOF echo &#34;aaa&#34; echo &#34;BBB&#34; EOF 内联重定向到文件">
<meta name=author content="zhxin">
<link rel=canonical href=https://zhxin.xyz/post/shell_script/>
<link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://zhxin.xyz/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=16x16 href=https://zhxin.xyz/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=32x32 href=https://zhxin.xyz/%3Clink%20/%20abs%20url%3E>
<link rel=apple-touch-icon href=https://zhxin.xyz/%3Clink%20/%20abs%20url%3E>
<link rel=mask-icon href=https://zhxin.xyz/%3Clink%20/%20abs%20url%3E>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-109514401-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Shell编程基础">
<meta property="og:description" content="变量 脚本开头使用#!/bin/bash指定要使用的shell,shell会通过PATH环境变量来查找脚本中使用的命令，可以使用echo $PATH来看下脚本会在哪些目录下查找命令，如果脚本中执行的命令没有在PATH环境变量中，也可以通过绝对或相对路径来引用.
在脚本中可以使用shell维护的环境变量也可以定义和使用自己的用户变量.
赋值等号两边不能存在空格
  环境变量：
可以使用set命令查看当前环境变量列表,例如$HOME、$HOSTNAME、$USER等;
  用户变量：
由字母数字下划线组成，长度不超过二十，区分大小写，变量、等号、值之间不能有空格，在shell脚本结束时会被删除掉，使用美元符号引用，例如name=&#34;test&#34;。
使用用户变量保存命令执行结果：testing=$(date)
  特殊参数变量
   参数 描述     $0 $1 $2 入参   $# 参数个数   $* 入参列表，将所有参数当作单个参数   $@ 入参列表，单独处理每个参      重定向输入输出 输出重定向: > 追加：>>
输入重定向: < 在脚本中使用< > 需要进行转义\< \>
内联输入重定向：
command << marker content marker # 例如：  wc -l <<EOF echo &#34;aaa&#34; echo &#34;BBB&#34; EOF 内联重定向到文件">
<meta property="og:type" content="article">
<meta property="og:url" content="https://zhxin.xyz/post/shell_script/"><meta property="og:image" content="https://zhxin.xyz/bg.jpg"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-06-28T22:49:38+08:00">
<meta property="article:modified_time" content="2021-06-28T22:49:38+08:00"><meta property="og:site_name" content="zhxin">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://zhxin.xyz/bg.jpg">
<meta name=twitter:title content="Shell编程基础">
<meta name=twitter:description content="变量 脚本开头使用#!/bin/bash指定要使用的shell,shell会通过PATH环境变量来查找脚本中使用的命令，可以使用echo $PATH来看下脚本会在哪些目录下查找命令，如果脚本中执行的命令没有在PATH环境变量中，也可以通过绝对或相对路径来引用.
在脚本中可以使用shell维护的环境变量也可以定义和使用自己的用户变量.
赋值等号两边不能存在空格
  环境变量：
可以使用set命令查看当前环境变量列表,例如$HOME、$HOSTNAME、$USER等;
  用户变量：
由字母数字下划线组成，长度不超过二十，区分大小写，变量、等号、值之间不能有空格，在shell脚本结束时会被删除掉，使用美元符号引用，例如name=&#34;test&#34;。
使用用户变量保存命令执行结果：testing=$(date)
  特殊参数变量
   参数 描述     $0 $1 $2 入参   $# 参数个数   $* 入参列表，将所有参数当作单个参数   $@ 入参列表，单独处理每个参      重定向输入输出 输出重定向: > 追加：>>
输入重定向: < 在脚本中使用< > 需要进行转义\< \>
内联输入重定向：
command << marker content marker # 例如：  wc -l <<EOF echo &#34;aaa&#34; echo &#34;BBB&#34; EOF 内联重定向到文件">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zhxin.xyz/post/"},{"@type":"ListItem","position":2,"name":"Shell编程基础","item":"https://zhxin.xyz/post/shell_script/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Shell编程基础","name":"Shell编程基础","description":"变量 脚本开头使用#!/bin/bash指定要使用的shell,shell会通过PATH环境变量来查找脚本中使用的命令，可以使用echo $PATH来看下脚本会在哪些目录下查找命令，如果脚本中执行的命令没有在PATH环境变量中，也可以通过绝对或相对路径来引用.\n在脚本中可以使用shell维护的环境变量也可以定义和使用自己的用户变量.\n赋值等号两边不能存在空格\n  环境变量：\n可以使用set命令查看当前环境变量列表,例如$HOME、$HOSTNAME、$USER等;\n  用户变量：\n由字母数字下划线组成，长度不超过二十，区分大小写，变量、等号、值之间不能有空格，在shell脚本结束时会被删除掉，使用美元符号引用，例如name=\u0026quot;test\u0026quot;。\n使用用户变量保存命令执行结果：testing=$(date)\n  特殊参数变量\n   参数 描述     $0 $1 $2 入参   $# 参数个数   $* 入参列表，将所有参数当作单个参数   $@ 入参列表，单独处理每个参      重定向输入输出 输出重定向: \u0026gt; 追加：\u0026gt;\u0026gt;\n输入重定向: \u0026lt; 在脚本中使用\u0026lt; \u0026gt; 需要进行转义\\\u0026lt; \\\u0026gt;\n内联输入重定向：\ncommand \u0026lt;\u0026lt; marker content marker # 例如：  wc -l \u0026lt;\u0026lt;EOF echo \u0026#34;aaa\u0026#34; echo \u0026#34;BBB\u0026#34; EOF 内联重定向到文件","keywords":["shell"],"articleBody":"变量 脚本开头使用#!/bin/bash指定要使用的shell,shell会通过PATH环境变量来查找脚本中使用的命令，可以使用echo $PATH来看下脚本会在哪些目录下查找命令，如果脚本中执行的命令没有在PATH环境变量中，也可以通过绝对或相对路径来引用.\n在脚本中可以使用shell维护的环境变量也可以定义和使用自己的用户变量.\n赋值等号两边不能存在空格\n  环境变量：\n可以使用set命令查看当前环境变量列表,例如$HOME、$HOSTNAME、$USER等;\n  用户变量：\n由字母数字下划线组成，长度不超过二十，区分大小写，变量、等号、值之间不能有空格，在shell脚本结束时会被删除掉，使用美元符号引用，例如name=\"test\"。\n使用用户变量保存命令执行结果：testing=$(date)\n  特殊参数变量\n   参数 描述     $0 $1 $2 入参   $# 参数个数   $* 入参列表，将所有参数当作单个参数   $@ 入参列表，单独处理每个参      重定向输入输出 输出重定向:  追加：\n输入重定向:  在脚本中使用 需要进行转义\\\n内联输入重定向：\ncommand content marker # 例如：  wc -l echo \"aaa\" echo \"BBB\" EOF 内联重定向到文件\ncat  demo.txt some content EOF    文件描述符 缩写 描述     0 STDIN 标准输入   1 STDOUT 标准输出   2 STDERR 标准错误    \u0026 符号会将所有输出重定向到一个文件内\nexec 1testout 在脚本中将STDOUT永久重定向到testout\nexec 3./testfile 创建写描述符3\nexec 3\u0026- 关闭文件描述符3\ncat /dev/null  file.log 可快速清空日志\n脚本中执行数学运算   使用美元符和方括号，只支持整型计算\nvar1=$[1 + 5]\nvar2=$[$var1 * 2]\nvar3=$[2 / 3]\n  通过bc进行浮点型计算:\nvar1=$(echo \"scale=4; 3.44 / 5\" | bc) var1=10.46 var2=43.67 var3=33.2 var4=71 var5=$(bcscale = 4 a1=($var1 * $var2) b1=($var3 * $var4) a1+b1 EOF ) echo \"$var5\"   退出脚本 默认情况shell会以脚本最后一个命令的退出状态码退出(0-255)\n可以使用exit命令指定脚本的退出码，并通过echo $?查看程序是否执行成功\n结构化命令 if语句 根据命令执行是否成功走不同分支\nif command1; then comands elif comand2; then comands else comands fi 或者使用条件测试的方式\nif [ condition ];then comands fi 条件测试   数值比较\n   比较 描述     n1 -eq n2 检查相等   n1 -ge n2 检查n1是否大于或等于n2   n1 -gt n2 检查n1是否大于n2   n1 -le n2 检查n1是否小于或等于n2   n1 -lt n2 检查n1是否小于n2   n1 -ne n2 检查n1是否不等于n2      字符串比较\n   比较 描述     str1 = str2 是否相同   str1 != str2 是否不同   str1 str1是否比str2大   str1  str2 str1是否比str2小   -n str1 检查str1的长度是否非0   -z str1 检查str1的长度是否为0      文件比较\n   比较 描述     -d file file是否存在并是目录   -e file file是否存在   -f file file是否存在并是文件   -r file 是否存在并可读   -s file 是否存在并非空   -w file 是否存在并可写   -x file 是否存在并可执行   -O file 是否存在并属于当前用户所有   -G file 是否存在并默认组与当前用户相同   file1 -nt file2 file1是否比file2新   file1 -ot file2 file1是否比file2旧      复合条件测试\n[ conditon1 ] \u0026\u0026 [ condition2 ]\n[ conditon1 ] || [ condition2 ]\n  使用双括号进行数学运算判断\n(( expression ))，支持的运算符号除普通运算符外还包括如下，大于小于符号不用转义 . val++ 、val--、 ++val、 --val ：自增自减\n! :求反 ~:位求反 **:幂运算 ：左位移 :右位移 \u0026:位布尔和|：位布尔或 \u0026\u0026：逻辑和 ||:逻辑或\n  可以在if语句中使用双括号命令，也可以在脚本中的普通命令里使用来赋值\n使用双方括号进行字符串比较\n[[ express ]]\nbash shell支持模式匹配: if [[ $USER == r* ]]  case语句 case variable in pattern1 | pattern2) commands1;; pattern3) comands2;; *) default commands;; esac for语句 for var in list do commands:$var done 有时候使用for line in $(cat $file)读取文本文件，默认会以空格分隔而不是换行符,需要修改IFS.\nIFS值：内部字段分隔符\nIFS.OLD=$IFS IFS=$’\\n’ #  IFS=$IFS.OLD C语言风格for语句\nfor (( i=1; i =10; i++ )) do ... done while语句 while [ condition ] do other commands done break: 跳出内部循环\ncontinue: 跳过本次循环\nbreak n: 可跳出外部循环\ncontinue n : 继续循环层级n的循环\n处理用户输入 利用getopts处理用户输入参数\nwhile getopts :ab:c opt do case \"$opt\" in a) echo \"found -a option\" ;; b) echo \"found -b option ,with value $OPTARG\" ;; c) echo \"found -c option\" ;; *) echo \"Unknown option: $opt\" ;; esac done shift $[ $OPTIND - 1 ] count=1 for param in \"$@\" do echo \"Parameter $count: $param\" count=$[ $count + 1] done 获取用户输入\nif read -t 10 -p \"Please enter your name: \" name then echo \"ok: $name\" else echo \"too slow\" exit 1 fi 使用临时文件 tempfile=$(mktemp tmp.XXXXXX) exec 3$tempfile echo “test” \u00263 exec 3\u0026- rm -f $tempfile 2/dev/null mktemp -t 生成在/tmp/目录下，返回全路径 控制脚本   记录消息\ndate | tee -a testfile\n  trap捕获处理信号\n  trap commands signals\ntrap “echo ‘ sorry i have trapped Ctrl-C’” SIGINT\ntrap -- SIGINT 删除捕获\n后台作业相关\ncommand \u0026：后台运行\nnohup comand: 后台运行\njobs: 列举作业\nbg: 后台重启作业\nfg: 将后台作业调到前台继续执行,可指定job号\nnice renice: 调整作业优先级\nat: 定时执行作业\natq: 定时作业队列\natrm: 删除作业\ncrontab定时任务时间表：\nmin hour dayofmonth month dayofweek command\nanacron:开机执行错过作业  shell函数  函数名必须唯一，否则会有问题  function name{ commands } #或者  name() { commands }   return 可以返回函数值：必须函数一结束就取$?;退出的状态码必须是0-255\n  超出255值可以使用 result=$(func1) 方式\n  每个函数可以单独使用自己的$# $1 $2 环境参数\n  变量作用域：\n  全局变量：不管在函数内外定义，脚本所有位置都可访问\n  局部变量：必须用local关键字显式声明\nlocal temp=$[ $value + 5]\n  数组相关：\n函数参数是数组情况处理：\nfunction testit { local newarray newarray=('echo \"$@\"') echo “The new array value is: ${newarray[*]}” } myarray=(1 2 3 4 5) testit ${myarray[*]} 工具推荐 shtool\nShellCheck\n","wordCount":"557","inLanguage":"zh","datePublished":"2021-06-28T22:49:38+08:00","dateModified":"2021-06-28T22:49:38+08:00","author":{"@type":"Person","name":"zhxin"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhxin.xyz/post/shell_script/"},"publisher":{"@type":"Organization","name":"zhxin","logo":{"@type":"ImageObject","url":"https://zhxin.xyz/%3Clink%20/%20abs%20url%3E"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://zhxin.xyz/ accesskey=h title="主页 (Alt + H)">
<img src=https://zhxin.xyz/apple-touch-icon.png alt aria-label=logo height=35>主页</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://zhxin.xyz/categories/ title=分类>
<span>分类</span>
</a>
</li>
<li>
<a href=https://zhxin.xyz/tags/ title=标签>
<span>标签</span>
</a>
</li>
<li>
<a href=https://zhxin.xyz/search/ title="搜索 (Alt + /)" accesskey=/>
<span>搜索</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://zhxin.xyz/>主页</a>&nbsp;»&nbsp;<a href=https://zhxin.xyz/post/>Posts</a></div>
<h1 class=post-title>
Shell编程基础
</h1>
<div class=post-meta><span title="2021-06-28 22:49:38 +0800 CST">2021-06-28</span>&nbsp;·&nbsp;3 分钟&nbsp;·&nbsp;557 字&nbsp;·&nbsp;zhxin
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>目录</span>
</summary>
<div class=inner><ul>
<li>
<a href=#%e5%8f%98%e9%87%8f aria-label=变量>变量</a></li>
<li>
<a href=#%e9%87%8d%e5%ae%9a%e5%90%91%e8%be%93%e5%85%a5%e8%be%93%e5%87%ba aria-label=重定向输入输出>重定向输入输出</a></li>
<li>
<a href=#%e8%84%9a%e6%9c%ac%e4%b8%ad%e6%89%a7%e8%a1%8c%e6%95%b0%e5%ad%a6%e8%bf%90%e7%ae%97 aria-label=脚本中执行数学运算>脚本中执行数学运算</a></li>
<li>
<a href=#%e9%80%80%e5%87%ba%e8%84%9a%e6%9c%ac aria-label=退出脚本>退出脚本</a></li>
<li>
<a href=#%e7%bb%93%e6%9e%84%e5%8c%96%e5%91%bd%e4%bb%a4 aria-label=结构化命令>结构化命令</a><ul>
<li>
<a href=#if%e8%af%ad%e5%8f%a5 aria-label=if语句>if语句</a></li>
<li>
<a href=#%e6%9d%a1%e4%bb%b6%e6%b5%8b%e8%af%95 aria-label=条件测试>条件测试</a></li>
<li>
<a href=#case%e8%af%ad%e5%8f%a5 aria-label=case语句>case语句</a></li>
<li>
<a href=#for%e8%af%ad%e5%8f%a5 aria-label=for语句>for语句</a></li>
<li>
<a href=#while%e8%af%ad%e5%8f%a5 aria-label=while语句>while语句</a></li></ul>
</li>
<li>
<a href=#%e5%a4%84%e7%90%86%e7%94%a8%e6%88%b7%e8%be%93%e5%85%a5 aria-label=处理用户输入>处理用户输入</a></li>
<li>
<a href=#%e4%bd%bf%e7%94%a8%e4%b8%b4%e6%97%b6%e6%96%87%e4%bb%b6 aria-label=使用临时文件>使用临时文件</a></li>
<li>
<a href=#%e6%8e%a7%e5%88%b6%e8%84%9a%e6%9c%ac aria-label=控制脚本>控制脚本</a><ul>
<li>
<a href=#shell%e5%87%bd%e6%95%b0 aria-label=shell函数>shell函数</a></li></ul>
</li>
<li>
<a href=#%e5%b7%a5%e5%85%b7%e6%8e%a8%e8%8d%90 aria-label=工具推荐>工具推荐</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=变量>变量<a hidden class=anchor aria-hidden=true href=#变量>#</a></h2>
<p>脚本开头使用<code>#!/bin/bash</code>指定要使用的shell,shell会通过PATH环境变量来查找脚本中使用的命令，可以使用<code>echo $PATH</code>来看下脚本会在哪些目录下查找命令，如果脚本中执行的命令没有在PATH环境变量中，也可以通过绝对或相对路径来引用.<br>
在脚本中可以使用shell维护的环境变量也可以定义和使用自己的用户变量.<br>
赋值等号两边不能存在空格</p>
<ul>
<li>
<p>环境变量：<br>
可以使用set命令查看当前环境变量列表,例如<code>$HOME</code>、<code>$HOSTNAME</code>、<code>$USER</code>等;</p>
</li>
<li>
<p>用户变量：<br>
由字母数字下划线组成，长度不超过二十，区分大小写，变量、等号、值之间不能有空格，在shell脚本结束时会被删除掉，使用美元符号引用，例如<code>name="test"</code>。<br>
使用用户变量保存命令执行结果：<code>testing=$(date)</code></p>
</li>
<li>
<p>特殊参数变量</p>
<table>
<thead>
<tr>
<th style=text-align:left>参数</th>
<th style=text-align:left>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>$0 $1 $2</td>
<td style=text-align:left>入参</td>
</tr>
<tr>
<td style=text-align:left>$#</td>
<td style=text-align:left>参数个数</td>
</tr>
<tr>
<td style=text-align:left>$*</td>
<td style=text-align:left>入参列表，将所有参数当作单个参数</td>
</tr>
<tr>
<td style=text-align:left>$@</td>
<td style=text-align:left>入参列表，单独处理每个参</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h2 id=重定向输入输出>重定向输入输出<a hidden class=anchor aria-hidden=true href=#重定向输入输出>#</a></h2>
<p>输出重定向: <code>></code> 追加：<code>>></code><br>
输入重定向: <code>&lt;</code>
在脚本中使用<code>&lt; ></code> 需要进行转义<code>\&lt; \></code><br>
内联输入重定向：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=nb>command</span> <span class=s>&lt;&lt; marker  
</span><span class=s> content  
</span><span class=s>marker</span>  
<span class=c1># 例如：  </span>
wc -l <span class=s>&lt;&lt;EOF  
</span><span class=s>echo &#34;aaa&#34;  
</span><span class=s>echo &#34;BBB&#34;  
</span><span class=s>EOF</span>  
</code></pre></div><p>内联重定向到文件</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>cat &gt;&gt; demo.txt <span class=s>&lt;&lt;EOF  
</span><span class=s> some content  
</span><span class=s>EOF</span>  
</code></pre></div><table>
<thead>
<tr>
<th style=text-align:left>文件描述符</th>
<th style=text-align:left>缩写</th>
<th style=text-align:left>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>0</td>
<td style=text-align:left>STDIN</td>
<td style=text-align:left>标准输入</td>
</tr>
<tr>
<td style=text-align:left>1</td>
<td style=text-align:left>STDOUT</td>
<td style=text-align:left>标准输出</td>
</tr>
<tr>
<td style=text-align:left>2</td>
<td style=text-align:left>STDERR</td>
<td style=text-align:left>标准错误</td>
</tr>
</tbody>
</table>
<p><code>&></code> 符号会将所有输出重定向到一个文件内<br>
<code>exec 1>testout</code> 在脚本中将STDOUT永久重定向到testout<br>
<code>exec 3>./testfile</code> 创建写描述符3<br>
<code>exec 3>&-</code> 关闭文件描述符3<br>
<code>cat /dev/null > file.log</code> 可快速清空日志</p>
<h2 id=脚本中执行数学运算>脚本中执行数学运算<a hidden class=anchor aria-hidden=true href=#脚本中执行数学运算>#</a></h2>
<ol>
<li>
<p>使用美元符和方括号，只支持整型计算<br>
<code>var1=$[1 + 5]</code><br>
<code>var2=$[$var1 * 2]</code><br>
<code>var3=$[2 / 3]</code></p>
</li>
<li>
<p>通过bc进行浮点型计算:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=nv>var1</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;scale=4; 3.44 / 5&#34;</span> <span class=p>|</span> bc<span class=k>)</span>  
<span class=nv>var1</span><span class=o>=</span>10.46  
<span class=nv>var2</span><span class=o>=</span>43.67  
<span class=nv>var3</span><span class=o>=</span>33.2  
<span class=nv>var4</span><span class=o>=</span><span class=m>71</span>  
<span class=nv>var5</span><span class=o>=</span><span class=k>$(</span>bc<span class=s>&lt;&lt;EOF  
</span><span class=s>scale = 4  
</span><span class=s>a1=($var1 * $var2)  
</span><span class=s>b1=($var3 * $var4)  
</span><span class=s>a1+b1  
</span><span class=s>EOF</span>  
<span class=k>)</span>  
<span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$var5</span><span class=s2>&#34;</span>  
</code></pre></div></li>
</ol>
<h2 id=退出脚本>退出脚本<a hidden class=anchor aria-hidden=true href=#退出脚本>#</a></h2>
<p>默认情况shell会以脚本最后一个命令的退出状态码退出(0-255)<br>
可以使用exit命令指定脚本的退出码，并通过<code>echo $?</code>查看程序是否执行成功</p>
<h2 id=结构化命令>结构化命令<a hidden class=anchor aria-hidden=true href=#结构化命令>#</a></h2>
<h3 id=if语句>if语句<a hidden class=anchor aria-hidden=true href=#if语句>#</a></h3>
<p>根据命令执行是否成功走不同分支</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=k>if</span> command1<span class=p>;</span> <span class=k>then</span>  
 comands  
<span class=k>elif</span> comand2<span class=p>;</span> <span class=k>then</span>  
 comands  
<span class=k>else</span>  
 comands  
<span class=k>fi</span>  
</code></pre></div><p>或者使用条件测试的方式</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=k>if</span> <span class=o>[</span> condition <span class=o>]</span><span class=p>;</span><span class=k>then</span>  
 comands  
<span class=k>fi</span>  
</code></pre></div><h3 id=条件测试>条件测试<a hidden class=anchor aria-hidden=true href=#条件测试>#</a></h3>
<ol>
<li>
<p>数值比较</p>
<table>
<thead>
<tr>
<th style=text-align:left>比较</th>
<th style=text-align:left>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>n1 -eq n2</td>
<td style=text-align:left>检查相等</td>
</tr>
<tr>
<td style=text-align:left>n1 -ge n2</td>
<td style=text-align:left>检查n1是否大于或等于n2</td>
</tr>
<tr>
<td style=text-align:left>n1 -gt n2</td>
<td style=text-align:left>检查n1是否大于n2</td>
</tr>
<tr>
<td style=text-align:left>n1 -le n2</td>
<td style=text-align:left>检查n1是否小于或等于n2</td>
</tr>
<tr>
<td style=text-align:left>n1 -lt n2</td>
<td style=text-align:left>检查n1是否小于n2</td>
</tr>
<tr>
<td style=text-align:left>n1 -ne n2</td>
<td style=text-align:left>检查n1是否不等于n2</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>字符串比较</p>
<table>
<thead>
<tr>
<th style=text-align:left>比较</th>
<th style=text-align:left>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>str1 = str2</td>
<td style=text-align:left>是否相同</td>
</tr>
<tr>
<td style=text-align:left>str1 != str2</td>
<td style=text-align:left>是否不同</td>
</tr>
<tr>
<td style=text-align:left>str1 &lt; str2</td>
<td style=text-align:left>str1是否比str2大</td>
</tr>
<tr>
<td style=text-align:left>str1 > str2</td>
<td style=text-align:left>str1是否比str2小</td>
</tr>
<tr>
<td style=text-align:left>-n str1</td>
<td style=text-align:left>检查str1的长度是否非0</td>
</tr>
<tr>
<td style=text-align:left>-z str1</td>
<td style=text-align:left>检查str1的长度是否为0</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>文件比较</p>
<table>
<thead>
<tr>
<th style=text-align:left>比较</th>
<th style=text-align:left>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>-d file</td>
<td style=text-align:left>file是否存在并是目录</td>
</tr>
<tr>
<td style=text-align:left>-e file</td>
<td style=text-align:left>file是否存在</td>
</tr>
<tr>
<td style=text-align:left>-f file</td>
<td style=text-align:left>file是否存在并是文件</td>
</tr>
<tr>
<td style=text-align:left>-r file</td>
<td style=text-align:left>是否存在并可读</td>
</tr>
<tr>
<td style=text-align:left>-s file</td>
<td style=text-align:left>是否存在并非空</td>
</tr>
<tr>
<td style=text-align:left>-w file</td>
<td style=text-align:left>是否存在并可写</td>
</tr>
<tr>
<td style=text-align:left>-x file</td>
<td style=text-align:left>是否存在并可执行</td>
</tr>
<tr>
<td style=text-align:left>-O file</td>
<td style=text-align:left>是否存在并属于当前用户所有</td>
</tr>
<tr>
<td style=text-align:left>-G file</td>
<td style=text-align:left>是否存在并默认组与当前用户相同</td>
</tr>
<tr>
<td style=text-align:left>file1 -nt file2</td>
<td style=text-align:left>file1是否比file2新</td>
</tr>
<tr>
<td style=text-align:left>file1 -ot file2</td>
<td style=text-align:left>file1是否比file2旧</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>复合条件测试<br>
<code>[ conditon1 ] && [ condition2 ]</code><br>
<code>[ conditon1 ] || [ condition2 ]</code></p>
</li>
<li>
<p>使用双括号进行数学运算判断<br>
<code>(( expression ))</code>，支持的运算符号除普通运算符外还包括如下，大于小于符号不用转义 .
<code>val++</code> 、<code>val--</code>、 <code>++val</code>、 <code>--val</code> ：自增自减<br>
<code>!</code> :求反 <code>~</code>:位求反 <code>**</code>:幂运算 <code>&lt;&lt;</code>：左位移 <code>>></code>:右位移 <code>&</code>:位布尔和<code>|</code>：位布尔或 <code>&&</code>：逻辑和 <code>||</code>:逻辑或</p>
</li>
</ol>
<p>可以在if语句中使用双括号命令，也可以在脚本中的普通命令里使用来赋值</p>
<ol start=6>
<li>使用双方括号进行字符串比较<br>
<code>[[ express ]]</code><br>
bash shell支持模式匹配: <code>if [[ $USER == r* ]]</code></li>
</ol>
<h3 id=case语句>case语句<a hidden class=anchor aria-hidden=true href=#case语句>#</a></h3>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=k>case</span> variable in  
pattern1 <span class=p>|</span> pattern2<span class=o>)</span> commands1<span class=p>;;</span>  
pattern3<span class=o>)</span> comands2<span class=p>;;</span>  
*<span class=o>)</span> default commands<span class=p>;;</span>  
<span class=k>esac</span>  
</code></pre></div><h3 id=for语句>for语句<a hidden class=anchor aria-hidden=true href=#for语句>#</a></h3>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=k>for</span> var in list  
<span class=k>do</span>  
 commands:<span class=nv>$var</span>  
<span class=k>done</span>  
</code></pre></div><p>有时候使用<code>for line in $(cat $file)</code>读取文本文件，默认会以空格分隔而不是换行符,需要修改IFS.<br>
IFS值：内部字段分隔符</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>IFS.OLD<span class=o>=</span><span class=nv>$IFS</span>  
<span class=nv>IFS</span><span class=o>=</span>$’<span class=se>\n</span>’  
<span class=c1>#&lt;在代码中使用新的IFS值&gt;  </span>
<span class=nv>IFS</span><span class=o>=</span><span class=nv>$IFS</span>.OLD  
</code></pre></div><p>C语言风格for语句</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=k>for</span>  <span class=o>((</span> <span class=nv>i</span><span class=o>=</span>1<span class=p>;</span> i &lt;<span class=o>=</span>10<span class=p>;</span> i++ <span class=o>))</span>  
<span class=k>do</span>  
...  
<span class=k>done</span>  
</code></pre></div><h3 id=while语句>while语句<a hidden class=anchor aria-hidden=true href=#while语句>#</a></h3>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=k>while</span> <span class=o>[</span> condition <span class=o>]</span>  
<span class=k>do</span>  
 other commands  
<span class=k>done</span>  
</code></pre></div><p><code>break</code>: 跳出内部循环<br>
<code>continue</code>: 跳过本次循环<br>
<code>break n</code>: 可跳出外部循环<br>
<code>continue n</code> : 继续循环层级n的循环</p>
<h2 id=处理用户输入>处理用户输入<a hidden class=anchor aria-hidden=true href=#处理用户输入>#</a></h2>
<p>利用getopts处理用户输入参数</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=k>while</span> <span class=nb>getopts</span> :ab:c opt  
<span class=k>do</span>  
 <span class=k>case</span> <span class=s2>&#34;</span><span class=nv>$opt</span><span class=s2>&#34;</span> in  
      a<span class=o>)</span> <span class=nb>echo</span> <span class=s2>&#34;found -a option&#34;</span> <span class=p>;;</span>  
      b<span class=o>)</span> <span class=nb>echo</span> <span class=s2>&#34;found -b option ,with value </span><span class=nv>$OPTARG</span><span class=s2>&#34;</span> <span class=p>;;</span>  
      c<span class=o>)</span> <span class=nb>echo</span> <span class=s2>&#34;found -c option&#34;</span> <span class=p>;;</span>  
      *<span class=o>)</span> <span class=nb>echo</span> <span class=s2>&#34;Unknown option: </span><span class=nv>$opt</span><span class=s2>&#34;</span> <span class=p>;;</span>  
      <span class=k>esac</span>  
<span class=k>done</span>  
<span class=nb>shift</span> $<span class=o>[</span> <span class=nv>$OPTIND</span> - <span class=m>1</span> <span class=o>]</span>  
<span class=nv>count</span><span class=o>=</span><span class=m>1</span>  
<span class=k>for</span> param in <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>  
<span class=k>do</span>  
    <span class=nb>echo</span> <span class=s2>&#34;Parameter </span><span class=nv>$count</span><span class=s2>: </span><span class=nv>$param</span><span class=s2>&#34;</span>  
    <span class=nv>count</span><span class=o>=</span>$<span class=o>[</span> <span class=nv>$count</span> + 1<span class=o>]</span>  
<span class=k>done</span>  
</code></pre></div><p>获取用户输入</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=k>if</span> <span class=nb>read</span> -t <span class=m>10</span> -p <span class=s2>&#34;Please enter your name: &#34;</span> name  
<span class=k>then</span>  
 <span class=nb>echo</span> <span class=s2>&#34;ok: </span><span class=nv>$name</span><span class=s2>&#34;</span>  
<span class=k>else</span>  
 <span class=nb>echo</span> <span class=s2>&#34;too slow&#34;</span>  
 <span class=nb>exit</span> <span class=m>1</span>  
<span class=k>fi</span>  
</code></pre></div><h2 id=使用临时文件>使用临时文件<a hidden class=anchor aria-hidden=true href=#使用临时文件>#</a></h2>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=nv>tempfile</span><span class=o>=</span><span class=k>$(</span>mktemp tmp.XXXXXX<span class=k>)</span>  
<span class=nb>exec</span> 3&gt;<span class=nv>$tempfile</span>  
<span class=nb>echo</span> “test” &gt;<span class=p>&amp;</span><span class=m>3</span>  
<span class=nb>exec</span> 3&gt;<span class=p>&amp;</span>-  
rm -f <span class=nv>$tempfile</span> 2&gt;/dev/null  
mktemp -t 生成在/tmp/目录下，返回全路径  
</code></pre></div><h2 id=控制脚本>控制脚本<a hidden class=anchor aria-hidden=true href=#控制脚本>#</a></h2>
<ol>
<li>
<p>记录消息<br>
<code>date | tee -a testfile</code></p>
</li>
<li>
<p>trap捕获处理信号</p>
</li>
</ol>
<p><code>trap commands signals</code><br>
<code>trap “echo ‘ sorry i have trapped Ctrl-C’” SIGINT</code><br>
<code>trap -- SIGINT</code> 删除捕获</p>
<ol start=3>
<li>后台作业相关<br>
<code>command &</code>：后台运行<br>
<code>nohup comand</code>: 后台运行<br>
<code>jobs</code>: 列举作业<br>
<code>bg</code>: 后台重启作业<br>
<code>fg</code>: 将后台作业调到前台继续执行,可指定job号<br>
<code>nice renice</code>: 调整作业优先级<br>
<code>at</code>: 定时执行作业<br>
<code>atq</code>: 定时作业队列<br>
<code>atrm</code>: 删除作业<br>
<code>crontab</code>定时任务时间表：<br>
min hour dayofmonth month dayofweek command<br>
<code>anacron</code>:开机执行错过作业</li>
</ol>
<h3 id=shell函数>shell函数<a hidden class=anchor aria-hidden=true href=#shell函数>#</a></h3>
<ul>
<li>函数名必须唯一，否则会有问题</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=k>function</span> name<span class=o>{</span>  
 commands  
<span class=o>}</span>  
<span class=c1>#或者  </span>
name<span class=o>()</span> <span class=o>{</span>  
 commands  
<span class=o>}</span>  
</code></pre></div><ul>
<li>
<p>return 可以返回函数值：必须函数一结束就取<code>$?</code>;退出的状态码必须是0-255</p>
</li>
<li>
<p>超出255值可以使用 <code>result=$(func1)</code> 方式</p>
</li>
<li>
<p>每个函数可以单独使用自己的<code>$# $1 $2</code> 环境参数</p>
</li>
<li>
<p>变量作用域：</p>
</li>
<li>
<p>全局变量：不管在函数内外定义，脚本所有位置都可访问</p>
</li>
<li>
<p>局部变量：必须用<code>local</code>关键字显式声明<br>
<code>local temp=$[ $value + 5]</code></p>
</li>
</ul>
<p>数组相关：<br>
函数参数是数组情况处理：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=k>function</span> testit <span class=o>{</span>  
 <span class=nb>local</span> newarray  
 <span class=nv>newarray</span><span class=o>=(</span><span class=s1>&#39;echo &#34;$@&#34;&#39;</span><span class=o>)</span>  
 <span class=nb>echo</span> “The new array value is: <span class=si>${</span><span class=nv>newarray</span><span class=p>[*]</span><span class=si>}</span>”  
<span class=o>}</span>  
<span class=nv>myarray</span><span class=o>=(</span><span class=m>1</span> <span class=m>2</span> <span class=m>3</span> <span class=m>4</span> 5<span class=o>)</span>  
testit <span class=si>${</span><span class=nv>myarray</span><span class=p>[*]</span><span class=si>}</span>  
</code></pre></div><h2 id=工具推荐>工具推荐<a hidden class=anchor aria-hidden=true href=#工具推荐>#</a></h2>
<p><a href=ftp://ftp.gnu.org/gnu/shtool/>shtool</a><br>
<a href=https://github.com/koalaman/shellcheck>ShellCheck</a></p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://zhxin.xyz/tags/shell/>shell</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://zhxin.xyz/post/pg_state_change_code/>
<span class=title>下一页 »</span>
<br>
<span>PG Peering过程状态变化代码走读</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2023 <a href=https://zhxin.xyz/>zhxin</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='复制';function d(){a.innerHTML='已复制！',setTimeout(()=>{a.innerHTML='复制'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>