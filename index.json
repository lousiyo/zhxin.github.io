[{"content":"å˜é‡ è„šæœ¬å¼€å¤´ä½¿ç”¨#!/bin/bashæŒ‡å®šè¦ä½¿ç”¨çš„shell,shellä¼šé€šè¿‡PATHç¯å¢ƒå˜é‡æ¥æŸ¥æ‰¾è„šæœ¬ä¸­ä½¿ç”¨çš„å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨echo $PATHæ¥çœ‹ä¸‹è„šæœ¬ä¼šåœ¨å“ªäº›ç›®å½•ä¸‹æŸ¥æ‰¾å‘½ä»¤ï¼Œå¦‚æœè„šæœ¬ä¸­æ‰§è¡Œçš„å‘½ä»¤æ²¡æœ‰åœ¨PATHç¯å¢ƒå˜é‡ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„æ¥å¼•ç”¨.\nåœ¨è„šæœ¬ä¸­å¯ä»¥ä½¿ç”¨shellç»´æŠ¤çš„ç¯å¢ƒå˜é‡ä¹Ÿå¯ä»¥å®šä¹‰å’Œä½¿ç”¨è‡ªå·±çš„ç”¨æˆ·å˜é‡.\nèµ‹å€¼ç­‰å·ä¸¤è¾¹ä¸èƒ½å­˜åœ¨ç©ºæ ¼\nç¯å¢ƒå˜é‡ï¼š\nå¯ä»¥ä½¿ç”¨setå‘½ä»¤æŸ¥çœ‹å½“å‰ç¯å¢ƒå˜é‡åˆ—è¡¨,ä¾‹å¦‚$HOMEã€$HOSTNAMEã€$USERç­‰;\nç”¨æˆ·å˜é‡ï¼š\nç”±å­—æ¯æ•°å­—ä¸‹åˆ’çº¿ç»„æˆï¼Œé•¿åº¦ä¸è¶…è¿‡äºŒåï¼ŒåŒºåˆ†å¤§å°å†™ï¼Œå˜é‡ã€ç­‰å·ã€å€¼ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œåœ¨shellè„šæœ¬ç»“æŸæ—¶ä¼šè¢«åˆ é™¤æ‰ï¼Œä½¿ç”¨ç¾å…ƒç¬¦å·å¼•ç”¨ï¼Œä¾‹å¦‚name=\u0026quot;test\u0026quot;ã€‚\nä½¿ç”¨ç”¨æˆ·å˜é‡ä¿å­˜å‘½ä»¤æ‰§è¡Œç»“æœï¼štesting=$(date)\nç‰¹æ®Šå‚æ•°å˜é‡\nå‚æ•° æè¿° $ 0 $1 $2 å…¥å‚ $# å‚æ•°ä¸ªæ•° $* å…¥å‚åˆ—è¡¨ï¼Œå°†æ‰€æœ‰å‚æ•°å½“ä½œå•ä¸ªå‚æ•° $@ å…¥å‚åˆ—è¡¨ï¼Œå•ç‹¬å¤„ç†æ¯ä¸ªå‚ é‡å®šå‘è¾“å…¥è¾“å‡º è¾“å‡ºé‡å®šå‘: \u0026gt; è¿½åŠ ï¼š\u0026gt;\u0026gt;\nè¾“å…¥é‡å®šå‘: \u0026lt; åœ¨è„šæœ¬ä¸­ä½¿ç”¨\u0026lt; \u0026gt; éœ€è¦è¿›è¡Œè½¬ä¹‰\\\u0026lt; \\\u0026gt;\nå†…è”è¾“å…¥é‡å®šå‘ï¼š\n1 2 3 4 5 6 7 8 command \u0026lt;\u0026lt; marker content marker # ä¾‹å¦‚ï¼š wc -l \u0026lt;\u0026lt;EOF echo \u0026#34;aaa\u0026#34; echo \u0026#34;BBB\u0026#34; EOF å†…è”é‡å®šå‘åˆ°æ–‡ä»¶\n1 2 3 cat \u0026gt;\u0026gt; demo.txt \u0026lt;\u0026lt;EOF some content EOF æ–‡ä»¶æè¿°ç¬¦ ç¼©å†™ æè¿° 0 STDIN æ ‡å‡†è¾“å…¥ 1 STDOUT æ ‡å‡†è¾“å‡º 2 STDERR æ ‡å‡†é”™è¯¯ \u0026amp;\u0026gt; ç¬¦å·ä¼šå°†æ‰€æœ‰è¾“å‡ºé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶å†…\nexec 1\u0026gt;testout åœ¨è„šæœ¬ä¸­å°†STDOUTæ°¸ä¹…é‡å®šå‘åˆ°testout\nexec 3\u0026gt;./testfile åˆ›å»ºå†™æè¿°ç¬¦3\nexec 3\u0026gt;\u0026amp;- å…³é—­æ–‡ä»¶æè¿°ç¬¦3\ncat /dev/null \u0026gt; file.log å¯å¿«é€Ÿæ¸…ç©ºæ—¥å¿—\nè„šæœ¬ä¸­æ‰§è¡Œæ•°å­¦è¿ç®— ä½¿ç”¨ç¾å…ƒç¬¦å’Œæ–¹æ‹¬å·ï¼Œåªæ”¯æŒæ•´å‹è®¡ç®— var1=$[1 + 5]\nvar2=$[$var1 * 2]\nvar3=$[2 / 3]\n2. é€šè¿‡bcè¿›è¡Œæµ®ç‚¹å‹è®¡ç®—:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ```bash var1=$(echo \u0026#34;scale=4; 3.44 / 5\u0026#34; | bc) var1=10.46 var2=43.67 var3=33.2 var4=71 var5=$(bc\u0026lt;\u0026lt;EOF scale = 4 a1=($var1 * $var2) b1=($var3 * $var4) a1+b1 EOF ) echo \u0026#34;$var5\u0026#34; ``` é€€å‡ºè„šæœ¬ é»˜è®¤æƒ…å†µshellä¼šä»¥è„šæœ¬æœ€åä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ç é€€å‡º(0-255)\nå¯ä»¥ä½¿ç”¨exitå‘½ä»¤æŒ‡å®šè„šæœ¬çš„é€€å‡ºç ï¼Œå¹¶é€šè¿‡echo $?æŸ¥çœ‹ç¨‹åºæ˜¯å¦æ‰§è¡ŒæˆåŠŸ\nç»“æ„åŒ–å‘½ä»¤ ifè¯­å¥ æ ¹æ®å‘½ä»¤æ‰§è¡Œæ˜¯å¦æˆåŠŸèµ°ä¸åŒåˆ†æ”¯\n1 2 3 4 5 6 7 if command1; then comands elif comand2; then comands else comands fi æˆ–è€…ä½¿ç”¨æ¡ä»¶æµ‹è¯•çš„æ–¹å¼\n1 2 3 if [ condition ];then comands fi æ¡ä»¶æµ‹è¯• æ•°å€¼æ¯”è¾ƒ\næ¯”è¾ƒ æè¿° n1 -eq n2 æ£€æŸ¥ç›¸ç­‰ n1 -ge n2 æ£€æŸ¥n1æ˜¯å¦å¤§äºæˆ–ç­‰äºn2 n1 -gt n2 æ£€æŸ¥n1æ˜¯å¦å¤§äºn2 n1 -le n2 æ£€æŸ¥n1æ˜¯å¦å°äºæˆ–ç­‰äºn2 n1 -lt n2 æ£€æŸ¥n1æ˜¯å¦å°äºn2 n1 -ne n2 æ£€æŸ¥n1æ˜¯å¦ä¸ç­‰äºn2 å­—ç¬¦ä¸²æ¯”è¾ƒ\næ¯”è¾ƒ æè¿° str1 = str2 æ˜¯å¦ç›¸åŒ str1 != str2 æ˜¯å¦ä¸åŒ str1 \u0026lt; str2 str1æ˜¯å¦æ¯”str2å¤§ str1 \u0026gt; str2 str1æ˜¯å¦æ¯”str2å° -n str1 æ£€æŸ¥str1çš„é•¿åº¦æ˜¯å¦é0 -z str1 æ£€æŸ¥str1çš„é•¿åº¦æ˜¯å¦ä¸º0 æ–‡ä»¶æ¯”è¾ƒ\næ¯”è¾ƒ æè¿° -d file fileæ˜¯å¦å­˜åœ¨å¹¶æ˜¯ç›®å½• -e file fileæ˜¯å¦å­˜åœ¨ -f file fileæ˜¯å¦å­˜åœ¨å¹¶æ˜¯æ–‡ä»¶ -r file æ˜¯å¦å­˜åœ¨å¹¶å¯è¯» -s file æ˜¯å¦å­˜åœ¨å¹¶éç©º -w file æ˜¯å¦å­˜åœ¨å¹¶å¯å†™ -x file æ˜¯å¦å­˜åœ¨å¹¶å¯æ‰§è¡Œ -O file æ˜¯å¦å­˜åœ¨å¹¶å±äºå½“å‰ç”¨æˆ·æ‰€æœ‰ -G file æ˜¯å¦å­˜åœ¨å¹¶é»˜è®¤ç»„ä¸å½“å‰ç”¨æˆ·ç›¸åŒ file1 -nt file2 file1æ˜¯å¦æ¯”file2æ–° file1 -ot file2 file1æ˜¯å¦æ¯”file2æ—§ å¤åˆæ¡ä»¶æµ‹è¯•\n[ conditon1 ] \u0026amp;\u0026amp; [ condition2 ]\n[ conditon1 ] || [ condition2 ]\nä½¿ç”¨åŒæ‹¬å·è¿›è¡Œæ•°å­¦è¿ç®—åˆ¤æ–­ (( expression ))ï¼Œæ”¯æŒçš„è¿ç®—ç¬¦å·é™¤æ™®é€šè¿ç®—ç¬¦å¤–è¿˜åŒ…æ‹¬å¦‚ä¸‹ï¼Œå¤§äºå°äºç¬¦å·ä¸ç”¨è½¬ä¹‰ . val++ ã€val--ã€ ++valã€ --val ï¼šè‡ªå¢è‡ªå‡\n! :æ±‚å ~:ä½æ±‚å **:å¹‚è¿ç®— \u0026lt;\u0026lt;ï¼šå·¦ä½ç§» \u0026gt;\u0026gt;:å³ä½ç§» \u0026amp;:ä½å¸ƒå°”å’Œ|ï¼šä½å¸ƒå°”æˆ– \u0026amp;\u0026amp;ï¼šé€»è¾‘å’Œ ||:é€»è¾‘æˆ–\nå¯ä»¥åœ¨ifè¯­å¥ä¸­ä½¿ç”¨åŒæ‹¬å·å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥åœ¨è„šæœ¬ä¸­çš„æ™®é€šå‘½ä»¤é‡Œä½¿ç”¨æ¥èµ‹å€¼\nä½¿ç”¨åŒæ–¹æ‹¬å·è¿›è¡Œå­—ç¬¦ä¸²æ¯”è¾ƒ [[ express ]]\nbash shellæ”¯æŒæ¨¡å¼åŒ¹é…: if [[ $USER == r* ]]\ncaseè¯­å¥ 1 2 3 4 5 case variable in pattern1 | pattern2) commands1;; pattern3) comands2;; *) default commands;; esac forè¯­å¥ 1 2 3 4 for var in list do commands:$var done æœ‰æ—¶å€™ä½¿ç”¨for line in $(cat $file)è¯»å–æ–‡æœ¬æ–‡ä»¶ï¼Œé»˜è®¤ä¼šä»¥ç©ºæ ¼åˆ†éš”è€Œä¸æ˜¯æ¢è¡Œç¬¦,éœ€è¦ä¿®æ”¹IFS.\nIFSå€¼ï¼šå†…éƒ¨å­—æ®µåˆ†éš”ç¬¦\n1 2 3 4 IFS.OLD=$IFS IFS=$â€™\\nâ€™ #\u0026lt;åœ¨ä»£ç ä¸­ä½¿ç”¨æ–°çš„IFSå€¼\u0026gt; IFS=$IFS.OLD Cè¯­è¨€é£æ ¼forè¯­å¥\n1 2 3 4 for (( i=1; i \u0026lt;=10; i++ )) do ... done whileè¯­å¥ 1 2 3 4 while [ condition ] do other commands done break: è·³å‡ºå†…éƒ¨å¾ªç¯\ncontinue: è·³è¿‡æœ¬æ¬¡å¾ªç¯\nbreak n: å¯è·³å‡ºå¤–éƒ¨å¾ªç¯\ncontinue n : ç»§ç»­å¾ªç¯å±‚çº§nçš„å¾ªç¯\nå¤„ç†ç”¨æˆ·è¾“å…¥ åˆ©ç”¨getoptså¤„ç†ç”¨æˆ·è¾“å…¥å‚æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 while getopts ğŸ†c opt do case \u0026#34;$opt\u0026#34; in a) echo \u0026#34;found -a option\u0026#34; ;; b) echo \u0026#34;found -b option ,with value $OPTARG\u0026#34; ;; c) echo \u0026#34;found -c option\u0026#34; ;; *) echo \u0026#34;Unknown option: $opt\u0026#34; ;; esac done shift $[ $OPTIND - 1 ] count=1 for param in \u0026#34;$@\u0026#34; do echo \u0026#34;Parameter $count: $param\u0026#34; count=$[ $count + 1] done è·å–ç”¨æˆ·è¾“å…¥\n1 2 3 4 5 6 7 if read -t 10 -p \u0026#34;Please enter your name: \u0026#34; name then echo \u0026#34;ok: $name\u0026#34; else echo \u0026#34;too slow\u0026#34; exit 1 fi ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ 1 2 3 4 5 6 tempfile=$(mktemp tmp.XXXXXX) exec 3\u0026gt;$tempfile echo â€œtestâ€ \u0026gt;\u0026amp;3 exec 3\u0026gt;\u0026amp;- rm -f $tempfile 2\u0026gt;/dev/null mktemp -t ç”Ÿæˆåœ¨/tmp/ç›®å½•ä¸‹ï¼Œè¿”å›å…¨è·¯å¾„ æ§åˆ¶è„šæœ¬ è®°å½•æ¶ˆæ¯ date | tee -a testfile\ntrapæ•è·å¤„ç†ä¿¡å· trap commands signals\ntrap â€œecho â€˜ sorry i have trapped Ctrl-Câ€™â€ SIGINT\ntrap -- SIGINT åˆ é™¤æ•è·\nåå°ä½œä¸šç›¸å…³ command \u0026amp;ï¼šåå°è¿è¡Œ\nnohup comand: åå°è¿è¡Œ\njobs: åˆ—ä¸¾ä½œä¸š\nbg: åå°é‡å¯ä½œä¸š\nfg: å°†åå°ä½œä¸šè°ƒåˆ°å‰å°ç»§ç»­æ‰§è¡Œ,å¯æŒ‡å®šjobå·\nnice renice: è°ƒæ•´ä½œä¸šä¼˜å…ˆçº§\nat: å®šæ—¶æ‰§è¡Œä½œä¸š\natq: å®šæ—¶ä½œä¸šé˜Ÿåˆ—\natrm: åˆ é™¤ä½œä¸š\ncrontabå®šæ—¶ä»»åŠ¡æ—¶é—´è¡¨ï¼š\nmin hour dayofmonth month dayofweek command\nanacron:å¼€æœºæ‰§è¡Œé”™è¿‡ä½œä¸š\nshellå‡½æ•° å‡½æ•°åå¿…é¡»å”¯ä¸€ï¼Œå¦åˆ™ä¼šæœ‰é—®é¢˜ 1 2 3 4 5 6 7 function name{ commands } [[æˆ–è€…]] name() { commands } return å¯ä»¥è¿”å›å‡½æ•°å€¼ï¼šå¿…é¡»å‡½æ•°ä¸€ç»“æŸå°±å–$?;é€€å‡ºçš„çŠ¶æ€ç å¿…é¡»æ˜¯0-255\nè¶…å‡º255å€¼å¯ä»¥ä½¿ç”¨ result=$(func1) æ–¹å¼\næ¯ä¸ªå‡½æ•°å¯ä»¥å•ç‹¬ä½¿ç”¨è‡ªå·±çš„$# $1 $2 ç¯å¢ƒå‚æ•°\nå˜é‡ä½œç”¨åŸŸï¼š\nå…¨å±€å˜é‡ï¼šä¸ç®¡åœ¨å‡½æ•°å†…å¤–å®šä¹‰ï¼Œè„šæœ¬æ‰€æœ‰ä½ç½®éƒ½å¯è®¿é—®\nå±€éƒ¨å˜é‡ï¼šå¿…é¡»ç”¨localå…³é”®å­—æ˜¾å¼å£°æ˜\nlocal temp=$[ $value + 5]\næ•°ç»„ç›¸å…³ï¼š\nå‡½æ•°å‚æ•°æ˜¯æ•°ç»„æƒ…å†µå¤„ç†ï¼š\n1 2 3 4 5 6 7 function testit { local newarray newarray=(\u0026#39;echo \u0026#34;$@\u0026#34;\u0026#39;) echo â€œThe new array value is: ${newarray[*]}â€ } myarray=(1 2 3 4 5) testit ${myarray[*]} å¤šè¿›ç¨‹æ‰§è¡Œå‡½æ•° 1 2 3 4 5 function multi {} multi argu1\u0026amp; multi argu2\u0026amp; multi argu3\u0026amp; wait trapæ•è·ä¿¡å· Trapping ctrl-c in Bash\nYou can use the trap builtin to handle a user pressing ctrl-c during the execution of a Bash script. e.g. if you need to perform some cleanup functions.\n1 2 3 4 5 6 7 8 9 10 11 12 13 #!/bin/bash [[trap]] ctrl-c and call ctrl_c() trap ctrl_c INT function ctrl_c() { echo \u0026#34;** Trapped CTRL-C\u0026#34; } for i in `seq 1 5`; do sleep 1 echo -n \u0026#34;.\u0026#34; done debug åœ¨è°ƒç”¨è„šæœ¬çš„æ—¶å€™å¼€å¯deubg sh -x shell.sh\n2. åœ¨è„šæœ¬æ–‡ä»¶é¦–è¡Œå¼€å¯deubg\n#!/bin/bash -x\n3. ä½¿ç”¨setå¼€å¯deubg\nset -x\n4. -v æ˜¾ç¤ºè„šæœ¬æ‰€æœ‰è¡Œï¼Œè¯¦ç»†æ¨¡å¼ï¼Œåœ¨è„šæœ¬åµŒå¥—è°ƒç”¨æ—¶æ¯”è¾ƒæœ‰ç”¨\nsh -v shell.sh\n5. -n æ£€æŸ¥è„šæœ¬çš„è¯­æ³•ï¼Œä¸æ‰§è¡Œè„šæœ¬çš„å‘½ä»¤\nsh -n shell.sh\nè¿œç¨‹æ‰§è¡Œå‘½ä»¤ ssh -n \u0026lsquo;command\u0026rsquo; å¯é¿å…åœ¨whileå¾ªç¯ä¸­åstdinæ•°æ®\nå·¥å…·æ¨è shtool\nShellCheck\n","permalink":"https://zhxin.xyz/post/shell_script/","summary":"å˜é‡ è„šæœ¬å¼€å¤´ä½¿ç”¨#!/bin/bashæŒ‡å®šè¦ä½¿ç”¨çš„shell,shellä¼šé€šè¿‡PATHç¯å¢ƒå˜é‡æ¥æŸ¥æ‰¾è„šæœ¬ä¸­ä½¿ç”¨çš„å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨echo $PA","title":"Shellç¼–ç¨‹åŸºç¡€"},{"content":"æœ€è¿‘çœ‹äº†PGçŠ¶æ€è½¬æ¢çš„è¿‡ç¨‹,ä»£ç ç»†èŠ‚æ²¡æœ‰ä»”ç»†ç ”ç©¶ï¼Œå…ˆç²—ç•¥è¿‡äº†ä¸€éä»£ç ï¼Œç‰¹æ­¤è®°å½•.\nPG PGæ˜¯å­˜å‚¨æ± çš„åŸºæœ¬å•å…ƒï¼Œæ˜¯ä¸€äº›å¯¹è±¡çš„é›†åˆï¼Œå¤šå‰¯æœ¬å’Œçº åˆ çš„æ•°æ®å¤‡ä»½ç­–ç•¥ä¾æ‰˜PGå®ç°. PGæœ‰å¤šç§çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´çš„å˜åŒ–é€šè¿‡çŠ¶æ€æœºå®ç°.\næœ‰ä¸¤ä¸ªåœºæ™¯ä¼šè§¦å‘peeringæµç¨‹ï¼š\nåœ¨pgåˆ›å»ºæ—¶ åœ¨OSDå¯åŠ¨ã€åœæ­¢å¯¼è‡´OSDMapå˜åŒ–è¿›è€Œå¯¼è‡´pgçš„acting setå‘ç”Ÿå˜åŒ–æ—¶ çŠ¶æ€æœº çŠ¶æ€æœºåœ¨åˆ›å»ºPGè¿›è¡Œåˆå§‹åŒ–.\n1 2 3 4 5 6 7 8 class RecoveryMachine : public boost::statechart::state_machine\u0026lt; RecoveryMachine, Initial \u0026gt; { RecoveryState *state; public: PG *pg; utime_t event_time; uint64_t event_count; ... boost::statechatåŒ…å«å¯¹è±¡ï¼š\nstate_machine: çŠ¶æ€æœº state: çŠ¶æ€ eventï¼šäº‹ä»¶ å¯é€šè¿‡process_eventå‡½æ•°è¿›è¡Œäº‹ä»¶æŠ•é€’ transition / custom_reaction: è½¬ç§»/ååº” custom_reactioné€šè¿‡å¯¹äºreactå‡½æ•°è¿›è¡Œå¤„ç† PGçŠ¶æ€æœºçš„å¯¹è±¡ã€çŠ¶æ€åŠæ—¶é—´å¤„ç†ä¸»è¦åœ¨PG.hã€PG.ccæ–‡ä»¶ä¸­. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 struct Initial : boost::statechart::state\u0026lt; Initial, RecoveryMachine \u0026gt;, NamedState { explicit Initial(my_context ctx); void exit(); typedef boost::mpl::list \u0026lt; boost::statechart::transition\u0026lt; Initialize, Reset \u0026gt;, boost::statechart::custom_reaction\u0026lt; Load \u0026gt;, boost::statechart::custom_reaction\u0026lt; NullEvt \u0026gt;, boost::statechart::transition\u0026lt; boost::statechart::event_base, Crashed \u0026gt; \u0026gt; reactions; boost::statechart::result react(const Load\u0026amp;); boost::statechart::result react(const MNotifyRec\u0026amp;); boost::statechart::result react(const MInfoRec\u0026amp;); boost::statechart::result react(const MLogRec\u0026amp;); boost::statechart::result react(const boost::statechart::event_base\u0026amp;) { return discard_event(); } }; PGçŠ¶æ€æœºä¸»è¦åŒ…å«çš„çŠ¶æ€å¦‚ä¸‹å›¾:\nPrimary Peering Primary Peeringè¿‡ç¨‹ä¸­çŠ¶æ€æœºæµç¨‹å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¹¶æ²¡æœ‰å±•ç¤ºä»OSDå’ŒRecoveryã€Backfillè¿‡ç¨‹.\nä¸»OSDæ¥å—åˆ°pg_createæ¶ˆæ¯å¼€å§‹åˆ›å»ºPG\n1 2 3 4 5 6 7 8 void OSD::handle_pg_create(OpRequestRef op) { MOSDPGCreate *m = (MOSDPGCreate*)op-\u0026gt;get_req(); assert(m-\u0026gt;get_type() == MSG_OSD_PG_CREATE); dout(10) \u0026lt;\u0026lt; \u0026#34;handle_pg_create \u0026#34; \u0026lt;\u0026lt; *m \u0026lt;\u0026lt; dendl; ... ä¾æ¬¡è°ƒç”¨handle_pg_create-\u0026gt; handle_pg_peering_evt -\u0026gt; _create_lock_pg -\u0026gt; _open_lock_pg -\u0026gt; _make_pg,åˆ›å»ºPG.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 PG* OSD::_make_pg( OSDMapRef createmap, spg_t pgid) { dout(10) \u0026lt;\u0026lt; \u0026#34;_open_lock_pg \u0026#34; \u0026lt;\u0026lt; pgid \u0026lt;\u0026lt; dendl; PGPool pool = _get_pool(pgid.pool(), createmap); // create PG *pg; if (createmap-\u0026gt;get_pg_type(pgid.pgid) == pg_pool_t::TYPE_REPLICATED || createmap-\u0026gt;get_pg_type(pgid.pgid) == pg_pool_t::TYPE_ERASURE) pg = new ReplicatedPG(\u0026amp;service, createmap, pool, pgid); else assert(0); return pg; } åˆ›å»ºPGå®Œæˆä¹‹å,åœ¨handle_pg_create -\u0026gt; handle_pg_peering_evt -\u0026gt; handle_create å‡½æ•°ä¸­,å¼€å§‹è¿›è¡Œäº‹ä»¶æŠ•é€’å’Œäº‹ä»¶çš„å¤„ç†.\n1 2 3 4 5 6 7 8 9 void PG::handle_create(RecoveryCtx *rctx) { dout(10) \u0026lt;\u0026lt; \u0026#34;handle_create\u0026#34; \u0026lt;\u0026lt; dendl; rctx-\u0026gt;created_pgs.insert(this); Initialize evt; recovery_state.handle_event(evt, rctx); ActMap evt2; recovery_state.handle_event(evt2, rctx); } åœ¨åˆ›å»ºä¹‹åˆï¼ŒçŠ¶æ€æœºå¤„äºInitialçŠ¶æ€ï¼Œåœ¨æ­¤çŠ¶æ€ä¸‹åˆ›å»ºä¸€ä¸ªInitializeäº‹ä»¶ï¼ŒçŠ¶æ€æœºçš„handle_eventå‡½æ•°ä¼šè°ƒç”¨process_eventå‡½æ•°å°†äº‹ä»¶æŠ•é€’å‡ºå».\nå¯ä»¥çœ‹åˆ°åœ¨InitialçŠ¶æ€ä¸‹æ¥å—åˆ°Initializeäº‹ä»¶ä¹‹åï¼ŒçŠ¶æ€æœºç›´æ¥è½¬æ¢ä¸ºResetçŠ¶æ€.å…ˆè°ƒç”¨Resetæ„é€ å‡½æ•°,ç„¶åå¸¦ç€çŠ¶æ€é‡æ–°å›åˆ°handle_createå‡½æ•°å¤„ï¼Œç»§ç»­åˆ›å»ºActMapäº‹ä»¶ç„¶åæŠ•é€’å‡ºå».\nResetçŠ¶æ€ä¸‹æ¥æ”¶åˆ°ActMapäº‹ä»¶ååœ¨å¯¹åº”å®šä¹‰çš„reactå‡½æ•°ä¸­è¿›è¡Œå¤„ç†.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 boost::statechart::result PG::RecoveryState::Reset::react(const ActMap\u0026amp;) { PG *pg = context\u0026lt; RecoveryMachine \u0026gt;().pg; if (pg-\u0026gt;should_send_notify() \u0026amp;\u0026amp; pg-\u0026gt;get_primary().osd \u0026gt;= 0) { context\u0026lt; RecoveryMachine \u0026gt;().send_notify( pg-\u0026gt;get_primary(), pg_notify_t( pg-\u0026gt;get_primary().shard, pg-\u0026gt;pg_whoami.shard, pg-\u0026gt;get_osdmap()-\u0026gt;get_epoch(), pg-\u0026gt;get_osdmap()-\u0026gt;get_epoch(), pg-\u0026gt;info), pg-\u0026gt;past_intervals); } pg-\u0026gt;update_heartbeat_peers(); pg-\u0026gt;take_waiters(); return transit\u0026lt; Started \u0026gt;(); } åœ¨reactå‡½æ•°ä¸­ï¼ŒçŠ¶æ€ç›´æ¥è½¬æ¢åˆ°StartedçŠ¶æ€, StartedçŠ¶æ€å®šä¹‰äº†å­çŠ¶æ€ï¼Œåˆ™ç›´æ¥è·³è½¬åˆ°Startå­çŠ¶æ€.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 struct Started : boost::statechart::state\u0026lt; Started, RecoveryMachine, Start \u0026gt;, NamedState { explicit Started(my_context ctx); void exit(); typedef boost::mpl::list \u0026lt; boost::statechart::custom_reaction\u0026lt; QueryState \u0026gt;, boost::statechart::custom_reaction\u0026lt; AdvMap \u0026gt;, boost::statechart::custom_reaction\u0026lt; NullEvt \u0026gt;, boost::statechart::custom_reaction\u0026lt; FlushedEvt \u0026gt;, boost::statechart::custom_reaction\u0026lt; IntervalFlush \u0026gt;, boost::statechart::transition\u0026lt; boost::statechart::event_base, Crashed \u0026gt; \u0026gt; reactions; boost::statechart::result react(const QueryState\u0026amp; q); boost::statechart::result react(const AdvMap\u0026amp;); boost::statechart::result react(const FlushedEvt\u0026amp;); boost::statechart::result react(const IntervalFlush\u0026amp;); boost::statechart::result react(const boost::statechart::event_base\u0026amp;) { return discard_event(); } }; æŸ¥çœ‹StartçŠ¶æ€çš„æ„é€ å‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 /*-------Start---------*/ PG::RecoveryState::Start::Start(my_context ctx) : my_base(ctx), NamedState(context\u0026lt; RecoveryMachine \u0026gt;().pg-\u0026gt;cct, \u0026#34;Start\u0026#34;) { context\u0026lt; RecoveryMachine \u0026gt;().log_enter(state_name); PG *pg = context\u0026lt; RecoveryMachine \u0026gt;().pg; if (pg-\u0026gt;is_primary()) { dout(1) \u0026lt;\u0026lt; \u0026#34;transitioning to Primary\u0026#34; \u0026lt;\u0026lt; dendl; post_event(MakePrimary()); } else { //is_stray dout(1) \u0026lt;\u0026lt; \u0026#34;transitioning to Stray\u0026#34; \u0026lt;\u0026lt; dendl; post_event(MakeStray()); } } é¦–å…ˆè·å–å½“å‰å¤„ç†çš„PGï¼Œåˆ¤æ–­å½“å‰osdæ˜¯ä¸æ˜¯è¯¥pgçš„ä¸»osdï¼Œå¦‚æœæ˜¯çš„è¯åˆ™æŠ•é€’MakePrimaryäº‹ä»¶ï¼Œå¦åˆ™æŠ•é€’MakeStrayäº‹ä»¶ï¼Œå¦‚æœè¿›å…¥StrayçŠ¶æ€åˆ™å¯¹åº”PGå®ä¾‹éœ€è¦ç”±å½“å‰PrimaryæŒ‰ç…§Peeringçš„è¿›åº¦å’Œç»“æœè¿›ä¸€æ­¥ç¡®è®¤å…¶èº«ä»½.\næŒ‰ç…§ä¸»OSDçš„è·¯å¾„ç»§ç»­èµ°, åœ¨StartçŠ¶æ€ä¸‹æ¥å—åˆ°MakePrimaryäº‹ä»¶åï¼ŒçŠ¶æ€æœºä¼šä¾æ¬¡è¿›å…¥åˆ°Started/Primary/Peering/Getinfoï¼Œè¿›å…¥peeringé˜¶æ®µã€‚\nGetInfoè¿‡ç¨‹è·å–è¯¥PGåœ¨å…¶ä»–OSDä¸Šçš„pg_info_tä¿¡æ¯ã€‚\nè°ƒç”¨å‡½æ•°generate_past_intervalsè®¡ç®—past intervalsçš„å€¼. è°ƒç”¨å‡½æ•°build_prioræ„é€ è·å–pg_info_tä¿¡æ¯çš„OSDåˆ—è¡¨\nè°ƒç”¨get_infosç»™å‚ä¸çš„OSDå‘é€è·å–è¯·æ±‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 /*--------GetInfo---------*/ PG::RecoveryState::GetInfo::GetInfo(my_context ctx) : my_base(ctx), NamedState(context\u0026lt; RecoveryMachine \u0026gt;().pg-\u0026gt;cct, \u0026#34;Started/Primary/Peering/GetInfo\u0026#34;) { context\u0026lt; RecoveryMachine \u0026gt;().log_enter(state_name); PG *pg = context\u0026lt; RecoveryMachine \u0026gt;().pg; pg-\u0026gt;generate_past_intervals(); unique_ptr\u0026lt;PriorSet\u0026gt; \u0026amp;prior_set = context\u0026lt; Peering \u0026gt;().prior_set; assert(pg-\u0026gt;blocked_by.empty()); if (!prior_set.get()) pg-\u0026gt;build_prior(prior_set); pg-\u0026gt;reset_min_peer_features(); get_infos(); if (peer_info_requested.empty() \u0026amp;\u0026amp; !prior_set-\u0026gt;pg_down) { post_event(GotInfo()); } } ä¸»OSDæ”¶åˆ°pg_infoçš„ACKä¿¡æ¯åå°è£…æˆMNotifyRecäº‹ä»¶å‘é€ç»™çŠ¶æ€æœº.\nåœ¨å¯¹åº”reactå‡½æ•°ä¸­å¯¹æ‹‰å–çš„pg_infoè¿›è¡Œå¤„ç†ï¼Œåœ¨GetInfoçŠ¶æ€ä¸‹å¦‚æœæ‰€æœ‰çš„å‰¯æœ¬OSDéƒ½æˆåŠŸå°†ä¿¡æ¯è¿”å›ï¼Œåˆ™ä¼šæŠ•é€’GotInfoäº‹ä»¶.\nçŠ¶æ€æœºæ”¶åˆ°GotInfoäº‹ä»¶åï¼Œè·³è½¬åˆ°GetLogçŠ¶æ€ï¼Œåœ¨GetLogçš„æ„é€ å‡½æ•°ä¸­\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 /*------GetLog------------*/ PG::RecoveryState::GetLog::GetLog(my_context ctx) : my_base(ctx), NamedState( context\u0026lt; RecoveryMachine \u0026gt;().pg-\u0026gt;cct, \u0026#34;Started/Primary/Peering/GetLog\u0026#34;), msg(0) { context\u0026lt; RecoveryMachine \u0026gt;().log_enter(state_name); PG *pg = context\u0026lt; RecoveryMachine \u0026gt;().pg; // adjust acting? if (!pg-\u0026gt;choose_acting(auth_log_shard, false, \u0026amp;context\u0026lt; Peering \u0026gt;().history_les_bound)) { if (!pg-\u0026gt;want_acting.empty()) { post_event(NeedActingChange()); } else { post_event(IsIncomplete()); } return; } ... è°ƒç”¨choose_actingå‡½æ•°é€‰å‡ºå…·æœ‰æƒå¨æ—¥å¿—çš„OSDå¹¶è®¡ç®—wan_actingåˆ—è¡¨\nå¦‚æœè‡ªå·±å°±æ˜¯æƒå¨æ—¥å¿—ï¼Œåˆ™ä¸éœ€è¦æ‹‰å–ï¼Œç›´æ¥æŠ•é€’GotLogäº‹ä»¶è¿›å…¥ä¸‹ä¸€çŠ¶æ€\nå¦‚æœè‡ªå·±ä¸æ˜¯æƒå¨æ—¥å¿—ï¼Œåˆ™éœ€è¦å»å…·æœ‰æƒå¨æ—¥å¿—çš„OSDä¸Šå»æ‹‰å–ï¼Œå¹¶ä¸æœ¬åœ°æ—¥å¿—åˆå¹¶.é€šè¿‡å‘é€pg_query_t::LOGäº‹ä»¶åˆ°å…·æœ‰æƒå¨æ—¥å¿—çš„OSDè¿›è¡Œæ‹‰å–,å½“æ”¶åˆ°æƒå¨æ—¥å¿—åï¼Œå°è£…æˆMLogRecç±»å‹äº‹ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 boost::statechart::result PG::RecoveryState::GetLog::react(const MLogRec\u0026amp; logevt) { assert(!msg); if (logevt.from != auth_log_shard) { dout(10) \u0026lt;\u0026lt; \u0026#34;GetLog: discarding log from \u0026#34; \u0026lt;\u0026lt; \u0026#34;non-auth_log_shard osd.\u0026#34; \u0026lt;\u0026lt; logevt.from \u0026lt;\u0026lt; dendl; return discard_event(); } dout(10) \u0026lt;\u0026lt; \u0026#34;GetLog: received master log from osd\u0026#34; \u0026lt;\u0026lt; logevt.from \u0026lt;\u0026lt; dendl; msg = logevt.msg; post_event(GotLog()); return discard_event(); } æŠ•é€’GotLogäº‹ä»¶åï¼Œè½¬ç§»åˆ°GetMissingçŠ¶æ€,è¿›å…¥GetMissingæ„é€ å‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 /*------GetMissing--------*/ PG::RecoveryState::GetMissing::GetMissing(my_context ctx) : my_base(ctx), NamedState(context\u0026lt; RecoveryMachine \u0026gt;().pg-\u0026gt;cct, \u0026#34;Started/Primary/Peering/GetMissing\u0026#34;) { context\u0026lt; RecoveryMachine \u0026gt;().log_enter(state_name); PG *pg = context\u0026lt; RecoveryMachine \u0026gt;().pg; assert(!pg-\u0026gt;actingbackfill.empty()); for (set\u0026lt;pg_shard_t\u0026gt;::iterator i = pg-\u0026gt;actingbackfill.begin(); i != pg-\u0026gt;actingbackfill.end(); ++i) { if (*i == pg-\u0026gt;get_primary()) continue; const pg_info_t\u0026amp; pi = pg-\u0026gt;peer_info[*i]; if (pi.is_empty()) continue; // no pg data, nothing divergent if (pi.last_update \u0026lt; pg-\u0026gt;pg_log.get_tail()) { dout(10) \u0026lt;\u0026lt; \u0026#34; osd.\u0026#34; \u0026lt;\u0026lt; *i \u0026lt;\u0026lt; \u0026#34; is not contiguous, will restart backfill\u0026#34; \u0026lt;\u0026lt; dendl; pg-\u0026gt;peer_missing[*i]; continue; } if (pi.last_backfill == hobject_t()) { dout(10) \u0026lt;\u0026lt; \u0026#34; osd.\u0026#34; \u0026lt;\u0026lt; *i \u0026lt;\u0026lt; \u0026#34; will fully backfill; can infer empty missing set\u0026#34; \u0026lt;\u0026lt; dendl; pg-\u0026gt;peer_missing[*i]; continue; } ... GetMissingå¤„ç†è¿‡ç¨‹ä¸­é¦–å…ˆæ‹‰å–å„ä¸ªä»OSDçš„æœ‰æ•ˆæ—¥å¿—ï¼Œç„¶åç”¨ä¸»OSDçš„æƒå¨æ—¥æ­¢ä¸å„ä¸ªä»OSDçš„æ—¥å¿—è¿›è¡Œå¯¹æ¯”ï¼Œä»è€Œè®¡ç®—å‡ºå„ä¸ªä»OSDä¸Šä¸ä¸€è‡´çš„å¯¹è±¡å¹¶ä¿å­˜åœ¨å¯¹åº”çš„pg_missing_tç»“æ„ä½“ä¸­ï¼Œä½œä¸ºåç»­æ•°æ®ä¿®å¤ä¾æ®.\nå¦‚æœæ‰€æœ‰è·å–æ—¥å¿—çš„è¯·æ±‚éƒ½è¿”å›å¹¶å¤„ç†å®Œæˆï¼Œåˆ™è°ƒç”¨Activate(pg-\u0026gt;get_osdmap()-\u0026gt;get_epoch()) è¿›å…¥ActiveçŠ¶æ€\n1 2 // all good! post_event(Activate(pg-\u0026gt;get_osdmap()-\u0026gt;get_epoch())); åˆ°æœ¬é˜¶æ®µåˆ™å¯ä»¥è¯´Peeringä¸»è¦å·¥ä½œå·²ç»å®Œæˆ,ä¸è¿‡åœ¨æ¥å—å®¢æˆ·ç«¯è¯»å†™ä¹‹å‰è¿˜éœ€è¦æ‰§è¡Œactiveæ“ä½œæ¿€æ´»å„ä¸ªå‰¯æœ¬ï¼Œè¯¥æ“ä½œä¸»è¦ç›®çš„ä¸ºå›ºåŒ–æœ¬åœ°peeringæˆæœï¼Œä»¥ä¿è¯å…¶ä¸è‡´å› ä¸ºç³»ç»Ÿæ‰ç”µè€Œå‰åŠŸå°½å¼ƒï¼ŒåŒæ—¶è¿˜éœ€è¦åˆå§‹åŒ–åç»­åœ¨åå°æ‰§è¡ŒRecoveryæˆ–è€…Backfillæ‰€ä¾èµ–çš„å…³é”®å…ƒæ•°æ®ä¿¡æ¯.\n1 2 3 4 5 6 pg-\u0026gt;activate(*context\u0026lt; RecoveryMachine \u0026gt;().get_cur_transaction(), pg-\u0026gt;get_osdmap()-\u0026gt;get_epoch(), *context\u0026lt; RecoveryMachine \u0026gt;().get_on_safe_context_list(), *context\u0026lt; RecoveryMachine \u0026gt;().get_query_map(), context\u0026lt; RecoveryMachine \u0026gt;().get_info_map(), context\u0026lt; RecoveryMachine \u0026gt;().get_recovery_ctx()); å¦‚æœæ‰€æœ‰å‰¯æœ¬éƒ½è¢«æ¿€æ´»åˆ™æŠ•é€’AllReplicasActivatedäº‹ä»¶ï¼Œåœ¨ActiveçŠ¶æ€ä¸‹å¤„ç†è¯¥äº‹ä»¶,å¤„ç†è¿‡ç¨‹ä¸­è°ƒç”¨pg-\u0026gt;on_activate()å‡½æ•°\nåœ¨è¯¥å‡½æ•°ä¸­æŸ¥çœ‹æ˜¯å¦éœ€è¦Recoveryéœ€è¦åˆ™è§¦å‘DoRecoveryäº‹ä»¶ï¼›æŸ¥çœ‹æ˜¯å¦éœ€è¦Backfillæ“ä½œï¼Œéœ€è¦åˆ™è§¦å‘RequestBackfillæ“ä½œ.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 void ReplicatedPG::on_activate() { // all clean? if (needs_recovery()) { dout(10) \u0026lt;\u0026lt; \u0026#34;activate not all replicas are up-to-date, queueing recovery\u0026#34; \u0026lt;\u0026lt; dendl; queue_peering_event( CephPeeringEvtRef( std::make_shared\u0026lt;CephPeeringEvt\u0026gt;( get_osdmap()-\u0026gt;get_epoch(), get_osdmap()-\u0026gt;get_epoch(), DoRecovery()))); } else if (needs_backfill()) { dout(10) \u0026lt;\u0026lt; \u0026#34;activate queueing backfill\u0026#34; \u0026lt;\u0026lt; dendl; queue_peering_event( CephPeeringEvtRef( std::make_shared\u0026lt;CephPeeringEvt\u0026gt;( get_osdmap()-\u0026gt;get_epoch(), get_osdmap()-\u0026gt;get_epoch(), RequestBackfill()))); } else { dout(10) \u0026lt;\u0026lt; \u0026#34;activate all replicas clean, no recovery\u0026#34; \u0026lt;\u0026lt; dendl; queue_peering_event( CephPeeringEvtRef( std::make_shared\u0026lt;CephPeeringEvt\u0026gt;( get_osdmap()-\u0026gt;get_epoch(), get_osdmap()-\u0026gt;get_epoch(), AllReplicasRecovered()))); } ... Recovery å¦‚æœPrimaryæ£€æµ‹è‡ªèº«æˆ–è€…ä»»æ„ä¸€ä¸ªPeerå­˜åœ¨å¾…ä¿®å¤çš„å¯¹è±¡ï¼Œå°†é€šè¿‡å‘çŠ¶æ€æœºæŠ•é€’DoRecoveryäº‹ä»¶ï¼Œåˆ‡æ¢åˆ°Started/Primary/Active/WaitLocalRecoveryReservedçŠ¶æ€ï¼Œå¼€å§‹å‡†å¤‡æ‰§è¡ŒRecovery.\nRecovery æ˜¯ä»…ä¾æ®PGæ—¥å¿—ä¸­çš„ç¼ºå¤±è®°å½•æ¥ä¿®å¤ä¸ä¸€è‡´çš„å¯¹è±¡.\nåœ¨ActivatingçŠ¶æ€æ¥å—åˆ°DoRecoveryäº‹ä»¶åï¼Œè½¬æ¢åˆ°WaitLocalRecoveryReservedçŠ¶æ€.\n1 2 3 4 5 6 7 8 9 10 struct Activating : boost::statechart::state\u0026lt; Activating, Active \u0026gt;, NamedState { typedef boost::mpl::list \u0026lt; boost::statechart::transition\u0026lt; AllReplicasRecovered, Recovered \u0026gt;, boost::statechart::transition\u0026lt; DoRecovery, WaitLocalRecoveryReserved \u0026gt;, boost::statechart::transition\u0026lt; RequestBackfill, WaitLocalBackfillReserved \u0026gt; \u0026gt; reactions; explicit Activating(my_context ctx); void exit(); }; ... åœ¨WaitLocalRecoveryReservedæ„é€ å‡½æ•°ä¸­ï¼Œé€šè¿‡request_reservationå‡½æ•°è¿›è¡Œèµ„æºé¢„ç•™è¯·æ±‚ï¼Œèµ„æºé¢„ç•™æ˜¯ä¸ºäº†æ§åˆ¶ä¸€ä¸ªOSDä¸Šæ­£åœ¨ä¿®å¤çš„PGæœ€å¤§æ•°ç›®ï¼Œåœ¨ä¸»OSDå’Œä»OSDä¸Šéƒ½éœ€è¦é¢„çº¦ã€‚å½“æ”¶åˆ°LocalRecoveryReservedäº‹ä»¶åï¼Œæ ‡å¿—æœ¬åœ°èµ„æºé¢„çº¦å®Œæˆ.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 PG::RecoveryState::WaitLocalRecoveryReserved::WaitLocalRecoveryReserved(my_context ctx) : my_base(ctx), NamedState(context\u0026lt; RecoveryMachine \u0026gt;().pg-\u0026gt;cct, \u0026#34;Started/Primary/Active/WaitLocalRecoveryReserved\u0026#34;) { context\u0026lt; RecoveryMachine \u0026gt;().log_enter(state_name); PG *pg = context\u0026lt; RecoveryMachine \u0026gt;().pg; pg-\u0026gt;state_set(PG_STATE_RECOVERY_WAIT); pg-\u0026gt;osd-\u0026gt;local_reserver.request_reservation( pg-\u0026gt;info.pgid, new QueuePeeringEvt\u0026lt;LocalRecoveryReserved\u0026gt;( pg, pg-\u0026gt;get_osdmap()-\u0026gt;get_epoch(), LocalRecoveryReserved()), pg-\u0026gt;get_recovery_priority()); pg-\u0026gt;publish_stats_to_osd(); } å½“æ”¶åˆ°LocalRecoveryReservedäº‹ä»¶åï¼Œæ ‡å¿—æœ¬åœ°èµ„æºé¢„çº¦å®Œæˆï¼Œç„¶åè½¬ç§»åˆ°WaitRemoteRecoveryReservedçŠ¶æ€\n1 2 3 4 5 6 7 struct WaitLocalRecoveryReserved : boost::statechart::state\u0026lt; WaitLocalRecoveryReserved, Active \u0026gt;, NamedState { typedef boost::mpl::list \u0026lt; boost::statechart::transition\u0026lt; LocalRecoveryReserved, WaitRemoteRecoveryReserved \u0026gt; \u0026gt; reactions; explicit WaitLocalRecoveryReserved(my_context ctx); void exit(); }; åœ¨WaitRemoteRecoveryReservedçŠ¶æ€ä¸‹ï¼Œå®Œæˆè¿œç¨‹èµ„æºçš„é¢„çº¦ï¼Œå½“æ¥æ”¶åˆ°RemoteRecoveryReservedåè¡¨æ˜èµ„æºéƒ½é¢„çº¦å®Œæˆï¼Œç„¶åæŠ•é€’AllRemotesReservedäº‹ä»¶ï¼Œæ ‡å¿—ç€è¯¥PGåœ¨æ‰€æœ‰å‚ä¸æ•°æ®ä¿®å¤çš„ä»OSDä¸Šå®Œæˆèµ„æºé¢„çº¦ï¼Œè¿›å…¥RecoveryçŠ¶æ€.\n1 2 3 4 5 6 7 8 9 10 11 12 PG::RecoveryState::Recovering::Recovering(my_context ctx) : my_base(ctx), NamedState(context\u0026lt; RecoveryMachine \u0026gt;().pg-\u0026gt;cct, \u0026#34;Started/Primary/Active/Recovering\u0026#34;) { context\u0026lt; RecoveryMachine \u0026gt;().log_enter(state_name); PG *pg = context\u0026lt; RecoveryMachine \u0026gt;().pg; pg-\u0026gt;state_clear(PG_STATE_RECOVERY_WAIT); pg-\u0026gt;state_set(PG_STATE_RECOVERING); pg-\u0026gt;publish_stats_to_osd(); pg-\u0026gt;osd-\u0026gt;queue_for_recovery(pg); } åœ¨RecoveryingçŠ¶æ€å®Œæˆå®é™…çš„æ•°æ®ä¿®å¤å·¥ä½œ\næŠŠPGçŠ¶æ€è®¾ç½®ä¸ºPG_STATE_RECOVERINGï¼Œå¹¶æŠŠPGæ·»åŠ åˆ°recovery_wqå·¥ä½œé˜Ÿåˆ—ä¸­ï¼Œå¼€å§‹å¯åŠ¨æ•°æ®ä¿®å¤.\nRecoveryè¿‡ç¨‹ç”±PGçš„ä¸»OSDæ¥è§¦å‘å¹¶æ§åˆ¶ï¼Œå…ˆä¿®å¤ä¸»çš„ï¼Œç„¶åä¿®å¤ä»çš„ã€‚\nåœ¨recovery_wqä¸­ï¼Œå·¥ä½œé˜Ÿåˆ—çš„çº¿ç¨‹æ± çš„å¤„ç†å‡½æ•°è°ƒç”¨do_recoveryå‡½æ•°æ‰§è¡Œå®é™…çš„æ•°æ®ä¿®å¤å·¥ä½œ.\n1 2 3 4 void _process(PG *pg, ThreadPool::TPHandle \u0026amp;handle) override { osd-\u0026gt;do_recovery(pg, handle); pg-\u0026gt;put(\u0026#34;RecoveryWQ\u0026#34;); } ReplicatedPG::start_recovery_opså‡½æ•°å®Œæˆå‰¯æœ¬ç±»å‹PGçš„ä¿®å¤å·¥ä½œ.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 bool ReplicatedPG::start_recovery_ops( int max, ThreadPool::TPHandle \u0026amp;handle, int *ops_started) { int\u0026amp; started = *ops_started; started = 0; bool work_in_progress = false; ... started = recover_replicas(max, handle); } if (!started) { // We still have missing objects that we should grab from replicas. started += recover_primary(max, handle); } ... å‡½æ•°ReplicatedPG::recover_primaryå®ŒæˆPGä¸»OSDç¼ºå¤±å¯¹è±¡çš„ä¿®å¤\nå¦‚æœåœ¨RecoveryingçŠ¶æ€å®ŒæˆRecoveryæ“ä½œåï¼Œå¦‚æœéœ€è¦Backfillå·¥ä½œåˆ™æ¥å—RequestBackfilläº‹ä»¶ï¼Œè¿›å…¥Backfillæµç¨‹\nå¦‚æœæ²¡æœ‰Backfillå·¥ä½œï¼Œç›´æ¥æ¥å—AllReplicasRecoveredäº‹ä»¶ï¼Œè½¬å…¥RecoveredçŠ¶æ€ è½¬å…¥RecoveredçŠ¶æ€ä¹‹åï¼Œæ„å‘³ç€å®Œæˆæ•°æ®ä¿®å¤å·¥ä½œï¼Œå½“æ”¶åˆ°GoCleanäº‹ä»¶åï¼ŒPGè¿›å…¥cleançŠ¶æ€.\nBackfill å’ŒRecoveryç±»ä¼¼ï¼Œå¦‚æœPrimaryå‘ç°è¿˜æœ‰å‰¯æœ¬éœ€è¦é€šè¿‡Backfillæ‰èƒ½ä¿®å¤ï¼Œåˆ™è¿›è¡ŒBackfillã€‚\nBackfillæ˜¯PGé€šè¿‡é‡æ–°æ‰«ææ‰€æœ‰çš„å¯¹è±¡ï¼Œå¯¹æ¯”å‘ç°ç¡®å®çš„å¯¹è±¡ï¼Œé€šè¿‡æ•´ä½“æ‹·è´æ¥ä¿®å¤ã€‚å’ŒRecoveryä¸€æ ·éœ€è¦è¿›è¡Œèµ„æºé¢„çº¦.\nè¿™éƒ¨åˆ†è¿‡ç¨‹å°±ä¸å†™äº†\u0026hellip;\n","permalink":"https://zhxin.xyz/post/pg_state_change_code/","summary":"æœ€è¿‘çœ‹äº†PGçŠ¶æ€è½¬æ¢çš„è¿‡ç¨‹,ä»£ç ç»†èŠ‚æ²¡æœ‰ä»”ç»†ç ”ç©¶ï¼Œå…ˆç²—ç•¥è¿‡äº†ä¸€éä»£ç ï¼Œç‰¹æ­¤è®°å½•. PG PGæ˜¯å­˜å‚¨æ± çš„åŸºæœ¬å•å…ƒï¼Œæ˜¯ä¸€äº›å¯¹è±¡çš„é›†åˆï¼Œå¤šå‰¯æœ¬å’Œçº åˆ çš„æ•°","title":"PG Peeringè¿‡ç¨‹çŠ¶æ€å˜åŒ–ä»£ç èµ°è¯»"},{"content":" å®‰è£…å®ŒæˆGITä¹‹åé…ç½®ç›¸å…³ç”¨æˆ·åé‚®ç®±. 1 2 git config --global user.name \u0026#34;xxx\u0026#34; git config --global user.email xxx@xxx.com é…ç½®è¿æ¥github. 1 2 3 4 ls -al ~/.ssh #æŸ¥çœ‹æ˜¯å¦ç”ŸæˆSSH key ssh-keygen -t rsa -b 4096 -C \u0026#34;xxx@xxx.com\u0026#34; #ç”Ÿæˆkey eval \u0026#34;$(ssh-agent -s)\u0026#34; #ä¿è¯sshå¯ç”¨ ssh-add ~/.ssh/id_rsa #æ·»åŠ ssh keyåˆ°å®¢æˆ·ç«¯ å°†ssh keyæ·»åŠ åˆ°githubè´¦æˆ· 1 2 clip \u0026lt; ~/.ssh/id_rsa.pub ssh -T git@github.com #æµ‹è¯•æ˜¯å¦è¿æ¥åˆ°github ","permalink":"https://zhxin.xyz/post/git-client-config/","summary":"\u003cul\u003e\n\u003cli\u003eå®‰è£…å®ŒæˆGITä¹‹åé…ç½®ç›¸å…³ç”¨æˆ·åé‚®ç®±.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit config --global user.name \u003cspan class=\"s2\"\u003e\u0026#34;xxx\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit config --global user.email xxx@xxx.com\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"Gitå®¢æˆ·ç«¯åˆå§‹é…ç½®"},{"content":"è½¬è½½è‡ªsysnote,å¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤\ncephåç«¯æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œä»¥æ’ä»¶å¼çš„æ–¹å¼æ¥è¿›è¡Œç®¡ç†ä½¿ç”¨ï¼Œç›®å‰æ”¯æŒfilestoreï¼Œkvstoreï¼Œmemstoreä»¥åŠæœ€æ–°çš„bluestoreï¼Œç›®å‰é»˜è®¤ä½¿ç”¨çš„filestoreï¼Œä½†æ˜¯å› ä¸ºfilestoreåœ¨å†™æ•°æ®å‰éœ€è¦å…ˆå†™journalï¼Œä¼šæœ‰ä¸€å€çš„å†™æ”¾å¤§ï¼Œå¹¶ä¸”filestoreä¸€å¼€å§‹åªæ˜¯å¯¹äºæœºæ¢°ç›˜è¿›è¡Œè®¾è®¡çš„ï¼Œæ²¡æœ‰ä¸“é—¨é’ˆå¯¹ssdåšä¼˜åŒ–è€ƒè™‘ï¼Œå› æ­¤è¯ç”Ÿçš„bluestoreåˆè¡·å°±æ˜¯ä¸ºäº†å‡å°‘å†™æ”¾å¤§ï¼Œå¹¶é’ˆå¯¹ssdåšä¼˜åŒ–ï¼Œè€Œä¸”ç›´æ¥ç®¡ç†è£¸ç›˜ï¼Œä»ç†è®ºä¸Šè¿›ä¸€æ­¥å‡å°‘æ–‡ä»¶ç³»ç»Ÿå¦‚ext4/xfsç­‰éƒ¨åˆ†çš„å¼€é”€ï¼Œç›®å‰bluestoreè¿˜å¤„äºå¼€å‘ä¼˜åŒ–é˜¶æ®µï¼Œåœ¨jewelç‰ˆæœ¬è¿˜æ˜¯è¯•ç”¨ç‰ˆæœ¬ï¼Œå¹¶ä¸”æœ€æ–°çš„masterç›¸æ¯”jewelå·²ç»åšäº†å¤§çš„é‡æ„ï¼Œé¢„æœŸä¼šåœ¨åç»­çš„å¤§ç‰ˆæœ¬ä¸­ç¨³å®šä¸‹æ¥æˆä¸ºé»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‚æœ¬æ–‡åŸºäºmasteråˆ†æ”¯å¯¹bluestoreå­˜å‚¨å¼•æ“è¿›è¡Œåˆ†æã€‚\nbluestoreæ•´ä½“æ¶æ„ bluestoreç›´æ¥ç®¡ç†è£¸è®¾å¤‡ï¼ŒæŠ›å¼ƒäº†ext4/xfsç­‰æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼ŒBlockDeviceå®ç°åœ¨ç”¨æˆ·æ€ä¸‹ä½¿ç”¨linux aioç›´æ¥å¯¹è£¸è®¾å¤‡è¿›è¡ŒI/Oæ“ä½œã€‚æ—¢ç„¶æ˜¯ç›´æ¥ç®¡ç†è£¸è®¾å¤‡å°±å¿…ç„¶éœ€è¦è¿›è¡Œè£¸è®¾å¤‡çš„ç©ºé—´ç®¡ç†ï¼Œå¯¹åº”çš„å°±æ˜¯Allocatorï¼Œç›®å‰æ”¯æŒStupidAllocatorå’ŒBitmapAllocatorä¸¤ç§åˆ†é…å™¨ã€‚ç›¸å…³çš„å…ƒæ•°æ®ä»¥kvçš„å½¢å¼ä¿å­˜åˆ°kvæ•°æ®åº“é‡Œï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯rocksdbï¼Œç”±äºrocksdbæœ¬èº«æ˜¯åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„ï¼Œä¸æ˜¯ç›´æ¥æ“ä½œè£¸è®¾å¤‡ï¼Œä½†æ˜¯rocksdbä¹Ÿæ¯”è¾ƒçµæ´»ï¼Œå°†ç³»ç»Ÿç›¸å…³çš„å¤„ç†æŠ½è±¡æˆEnvï¼Œç”¨æˆ·å¯ç”¨å®ç°ç›¸åº”çš„æ¥å£ï¼Œrocksdbé»˜è®¤çš„Envæ˜¯PosixEnvï¼Œç›´æ¥å¯¹æ¥æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œä¸ºæ­¤ï¼Œbluestoreå®ç°äº†ä¸€ä¸ªBlueRocksEnvï¼Œç»§æ‰¿è‡ªEnvWrapperï¼Œæ¥ä¸ºrocksdbæä¾›åº•å±‚ç³»ç»Ÿçš„å°è£…ï¼Œä¸ºäº†å¯¹æ¥BlueRocksEnvï¼Œå®ç°äº†ä¸€ä¸ªå°çš„æ–‡ä»¶ç³»ç»ŸBlueFSï¼Œåªå®ç°rocksdb Envéœ€è¦çš„æ¥å£ï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨mountè¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æ—¶å€™å°†æ‰€æœ‰çš„å…ƒæ•°æ®éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ï¼ŒBluesFSçš„æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶éƒ½é€šè¿‡BlockDeviceä¿å­˜åˆ°è£¸è®¾å¤‡ä¸Šï¼ŒBlueFSå’ŒBlueStoreå¯ä»¥å…±äº«è£¸è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥åˆ†åˆ«æŒ‡å®šä¸åŒçš„è®¾å¤‡ã€‚\nbluestoreå…ƒæ•°æ® åœ¨ä¹‹å‰çš„å­˜å‚¨å¼•æ“filestoreé‡Œï¼Œå¯¹è±¡çš„è¡¨ç°å½¢å¼æ˜¯å¯¹åº”åˆ°æ–‡ä»¶ç³»ç»Ÿé‡Œçš„æ–‡ä»¶ï¼Œé»˜è®¤4MBå¤§å°çš„æ–‡ä»¶ï¼Œä½†æ˜¯åœ¨bluestoreé‡Œï¼Œå·²ç»æ²¡æœ‰ä¼ ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œæ˜¯è‡ªå·±ç®¡ç†è£¸ç›˜ï¼Œå› æ­¤éœ€è¦æœ‰å…ƒæ•°æ®æ¥ç®¡ç†å¯¹è±¡ï¼Œå¯¹åº”çš„å°±æ˜¯Onodeï¼ŒOnodeæ˜¯å¸¸é©»å†…å­˜çš„æ•°æ®ç»“æ„ï¼ŒæŒä¹…åŒ–çš„æ—¶å€™ä¼šä»¥kvçš„å½¢å¼å­˜åˆ°rocksdbé‡Œã€‚\nåœ¨onodeé‡Œåˆåˆ†ä¸ºlextentï¼Œè¡¨ç¤ºé€»è¾‘çš„æ•°æ®å—ï¼Œç”¨ä¸€ä¸ªmapæ¥è®°å½•ï¼Œä¸€ä¸ªonodeé‡Œä¼šå­˜åœ¨å¤šä¸ªlextentï¼Œlextenté€šè¿‡blobçš„idå¯¹åº”åˆ°blobï¼ˆbluestore_blob_t ï¼‰ï¼Œblobé‡Œé€šè¿‡pextentå¯¹åº”åˆ°å®é™…ç‰©ç†ç›˜ä¸Šçš„åŒºåŸŸï¼ˆpextenté‡Œå°±æ˜¯offsetå’Œlengthæ¥å®šä½ç‰©ç†ç›˜çš„ä½ç½®åŒºåŸŸï¼‰ã€‚ä¸€ä¸ªonodeé‡Œçš„å¤šä¸ªlextentå¯èƒ½åœ¨åŒä¸€ä¸ªblobé‡Œï¼Œè€Œä¸€ä¸ªblobä¹Ÿå¯èƒ½å¯¹åº”åˆ°å¤šä¸ªpextentã€‚ å¦å¤–è¿˜æœ‰Bnodeè¿™ä¸ªå…ƒæ•°æ®ï¼Œå®ƒæ˜¯ç”¨æ¥è¡¨ç¤ºå¤šä¸ªobjectå¯èƒ½å…±äº«extentï¼Œç›®å‰åœ¨åšäº†å¿«ç…§åå†™I/Oè§¦å‘çš„cowè¿›è¡Œcloneçš„æ—¶å€™ä¼šç”¨åˆ°ã€‚\nI/Oè¯»å†™æ˜ å°„é€»è¾‘ å†™I/Oå¤„ç† åˆ°è¾¾bluestoreçš„I/Oçš„offsetå’Œlengthéƒ½æ˜¯å¯¹è±¡å†…ï¼ˆonodeï¼‰çš„ï¼Œoffsetæ˜¯ç›¸å¯¹äºè¿™ä¸ªå¯¹è±¡èµ·å§‹ä½ç½®çš„åç§»ï¼Œåœ¨_do_writeé‡Œé¦–å…ˆå°±ä¼šæ ¹æ®æœ€å°åˆ†é…å•ä½min_alloc_sizeè¿›è¡Œåˆ¤æ–­ï¼Œä»è€Œå°†I/Oåˆ†ä¸ºå¯¹é½å’Œéå¯¹é½çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå½“ä¸€ä¸ªå†™è¯·æ±‚æŒ‰ç…§min_alloc_sizeè¿›è¡Œæ‹†åˆ†åï¼Œå°±ä¼šåˆ†ä¸ºå¯¹é½å†™ï¼Œå¯¹åº”åˆ°do_write_bigï¼Œéå¯¹é½å†™ï¼ˆå³è½åˆ°æŸä¸€ä¸ªmin_alloc_sizeåŒºé—´çš„å†™I/Oï¼ˆå¯¹åº”åˆ°do_write_smallï¼‰ã€‚\ndo_write_big å¯¹é½åˆ°min_alloc_sizeçš„å†™è¯·æ±‚å¤„ç†èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œæœ‰å¯èƒ½æ˜¯å¤šä¸ªmin_alloc_sizeçš„å¤§å°ï¼Œåœ¨å¤„ç†æ—¶ä¼šæ ¹æ®å®é™…å¤§å°æ–°ç”Ÿæˆlextentå’Œblobï¼Œè¿™ä¸ªlextentè·¨è¶Šçš„åŒºåŸŸæ˜¯min_alloc_sizeçš„æ•´æ•°å€ï¼Œå¦‚æœè¿™æ®µåŒºé—´æ˜¯ä¹‹å‰å†™è¿‡çš„ï¼Œä¼šå°†ä¹‹å‰çš„lextentè®°å½•ä¸‹æ¥ä¾¿äºåç»­çš„ç©ºé—´å›æ”¶ã€‚\ndo_write_small åœ¨å¤„ç†è½åˆ°æŸä¸ªmin_alloc_sizeåŒºé—´çš„å†™è¯·æ±‚æ—¶ï¼Œä¼šé¦–å…ˆæ ¹æ®offsetå»æŸ¥æ‰¾æœ‰æ²¡æœ‰å¯ä»¥å¤ç”¨çš„blobï¼Œå› ä¸ºæœ€å°åˆ†é…å•å…ƒæ˜¯min_alloc_sizeï¼Œé»˜è®¤64KBï¼Œå¦‚æœä¸€ä¸ª4KBçš„å†™I/Oå°±åªä¼šç”¨åˆ°blobçš„ä¸€éƒ¨åˆ†ï¼Œblobé‡Œå‰©ä½™çš„è¿˜èƒ½æ”¾å…¶ä»–çš„ã€‚\næ²¡æœ‰æ‰¾åˆ°å¯ä»¥å¤ç”¨çš„blobï¼Œæ–°ç”Ÿæˆblob åœ¨å¤„ç†è¿˜è¿˜éœ€è¦æ ¹æ®offsetå’Œlenæ˜¯å¦å¯¹é½åˆ°block_sizeï¼ˆé»˜è®¤æ˜¯4KBï¼‰è¿›è¡Œè¡¥é›¶å¯¹é½çš„æ“ä½œï¼Œä¹‹æ‰€ä»¥éœ€è¦è¡¥é½æ˜¯ä¸åç»­çš„å†™ç›˜æ“ä½œæœ‰å…³ï¼ŒçœŸæ­£å†™ç›˜æ—¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯Direct I/Oçš„æ–¹å¼ï¼Œè¿™ç§è¦æ±‚åç§»å’Œç¼“å†²åŒºéƒ½å¯¹é½çš„ï¼Œå¦å¤–ä¸€ç§éDirect I/Oï¼Œå³Buffered I/Oï¼Œè¿™ç§å¯ä»¥ä¸å¯¹é½ï¼Œä½†æ˜¯æ˜¯å†™åˆ°cacheé‡Œï¼Œç„¶åå†syncåˆ·åˆ°ç£ç›˜ä¸Šï¼Œæ¯”å¦‚åªå†™äº†100å­—èŠ‚ï¼Œåœ¨å†…æ ¸é‡Œæ˜¯éœ€è¦å…ˆä»è®¾å¤‡ä¸Šè¯»å‡ºæ¥è¡¥é½æˆä¸€ä¸ªå®Œæ•´çš„æ‰‡åŒºï¼Œç„¶åå†åˆ·çš„ï¼Œè¿™æ ·åè€Œé™ä½äº†æ•ˆç‡ã€‚å› æ­¤åœ¨bluestoreé‡Œç›´æ¥å¤„ç†å¥½å¯¹é½ï¼Œå¯¹äºåé¢çš„å†™ç›˜æ¥è¯´æ¯”è¾ƒæœ‰åˆ©ï¼Œè¿™é‡Œå¯¹é½åˆ°block_sizeï¼Œæ˜¯ä¸ªå¯é…ç½®çš„å‚æ•°ã€‚\nè¿›è¡Œå¯¹é½è¡¥é›¶æ—¶å°±æ˜¯æŒ‰ç…§å¦‚ä¸Šå›¾é‚£æ ·æŠŠå‰åå¯¹é½åˆ°block_sizeï¼Œç„¶åå†æŠŠå¯¹é½åçš„offsetå’Œlenä½œä¸ºlextentï¼Œè¿›è€Œæ”¾åˆ°blobé‡Œã€‚ 2. æ‰¾åˆ°å¯ä»¥å¤ç”¨çš„blob\nå¯¹äºå¯ä»¥å¤ç”¨çš„blobï¼Œä¹Ÿæ˜¯å…ˆæŒ‰ç…§block_sizeè¿›è¡Œå¯¹é½è¡¥é›¶çš„åŠ¨ä½œï¼Œç„¶åå†åˆ¤æ–­æ˜¯å¦å¯ä»¥ç›´æ¥ä½¿ç”¨blobé‡Œç©ºé—²çš„ç©ºé—´è¿›è¡ŒåŒºåˆ†åšä¸åŒçš„å¤„ç†ã€‚\na. ç›´æ¥å†™åœ¨blobæœªä½¿ç”¨çš„ç©ºé—´ä¸Š\nè¿™ç§æƒ…å†µä¸‹ç›´æ¥æ–°ç”Ÿæˆlextentæ”¾åˆ°blobé‡Œã€‚\nb. è¦†ç›–å†™çš„æƒ…å†µ\næ¯”å¦‚ä¸‹é¢çš„è¿™ç§æƒ…å†µï¼Œå†™I/Oä¼šè¦†ç›–éƒ¨åˆ†å·²ç»å†™è¿‡çš„æ•°æ®ã€‚\nå¯¹äºè¿™ç§æƒ…å†µçš„å¤„ç†å¦‚ä¸‹å›¾ï¼šä¹Ÿæ˜¯éœ€è¦å…ˆå¤„ç†å¯¹é½è¡¥é›¶çš„æƒ…å†µï¼Œå¦‚æœè¦†ç›–çš„åŒºåŸŸåˆšå¥½æ˜¯å·²ç»å¯¹é½åˆ°block_sizeï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ä»ç£ç›˜è¯»æ•°æ®ï¼Œä½†æ˜¯å¦‚æœè¦†ç›–çš„åŒºåŸŸæ²¡æœ‰å¯¹é½åˆ°block_sizeï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠä¸å¯¹é½çš„é‚£éƒ¨åˆ†è¯»å‡ºæ¥ï¼Œæ‹¼æˆä¸€ä¸ªå¯¹é½çš„bufferï¼Œç„¶åæ–°ç”Ÿæˆlextentï¼Œå¹¶ä¸”ä¼šå¯¹åŸæ¥é‚£ä¸ªlextentè¿›è¡Œè°ƒæ•´ï¼Œä¼šè®°å½•éœ€è¦å›æ”¶çš„é‚£éƒ¨åˆ†åŒºåŸŸã€‚å¯¹äºè¦†ç›–å†™çš„æƒ…å†µï¼Œéƒ½ä¸æ˜¯ç›´æ¥å†™ç›˜ï¼Œè€Œæ˜¯é€šè¿‡walå†™åˆ°rocksdbã€‚\næ•´ä½“å†™I/Oçš„é€»è¾‘ ä¹‹å‰ç»„å†…åŒäº‹ç”»è¿‡ä¸€ä¸ªæµç¨‹å›¾ï¼Œè¿™é‡Œå€Ÿç”¨ä¸€ä¸‹ç®—æ˜¯ä¸€ä¸ªç®€å•çš„æ€»ç»“ã€‚\nè¯»I/Oçš„å¤„ç† è¯»I/Oè¯·æ±‚çš„å¤„ç†æ—¶ä¹Ÿæ˜¯é€šè¿‡å¯»æ‰¾ç›¸å…³è”çš„lextentï¼Œå¯èƒ½ä¼šå­˜åœ¨ç©ºæ´çš„æƒ…å†µï¼Œå³è¯»åˆ°æœªå†™è¿‡çš„æ•°æ®ï¼Œè¿™éƒ¨åˆ†å°±ç›´æ¥è¡¥é›¶ã€‚\ncloneåŠextentå…±äº« å‰é¢è¯´åˆ°Bnodeå°±æ˜¯ç”¨æ¥è®°å½•å…±äº«çš„lextentï¼Œç›®å‰æ˜¯åœ¨åšå®Œå¿«ç…§åå¯¹åŸå·è¿›è¡Œå†™I/Oä¼šè§¦å‘cowï¼Œä»è€Œäº§ç”Ÿcloneæ“ä½œã€‚cloneæ—¶å°±æ˜¯å°†åŸå¯¹è±¡çš„blobä»onode-\u0026gt;blob_mapç§»åˆ°onode-\u0026gt;bnode-\u0026gt;blob_mapï¼Œå¹¶ä¸”å°†blob idç½®ä¸ºè´Ÿçš„ï¼Œå¹¶è®¾ç½®å…±äº«æ ‡è®°ï¼Œç„¶åå°†æ–°çš„å¿«ç…§å¯¹è±¡çš„onode-\u0026gt;bnodeæŒ‡å‘åŸå¯¹è±¡çš„onode-\u0026gt;bnodeï¼Œå¹¶ä¸”ç”¨åŸonodeé‡Œçš„lextentsé‡Œçš„å€¼èµ‹ç»™æ–°çš„onodeçš„lextentsï¼Œä»è€Œè¾¾åˆ°å…±äº«extentçš„ç›®çš„ï¼Œå›¾ç¤ºä»…ä¾›å‚è€ƒã€‚\nåœ¨cloneå®Œä¹‹åï¼Œç»§ç»­å¯¹åŸå¯¹è±¡è¿›è¡Œå†™I/Oæ“ä½œæ—¶ï¼Œå½“ç¢°åˆ°å…±äº«çš„blobæ—¶å°±éœ€è¦è·³è¿‡ï¼Œæ–°ç”Ÿæˆblobï¼Œå¹¶ä¸”å–æ¶ˆå¯¹åŸæ¥é‚£éƒ¨åˆ†lextentçš„å¼•ç”¨ï¼Œåœ¨åç»­çš„ç©ºé—´é‡Šæ”¾æ—¶çš„åˆ¤æ–­ä¾æ®å°±æ˜¯å¦è¿˜æœ‰å¼•ç”¨ã€‚\nå°ç»“ æœ¬æ–‡æ€»ä½“ä¸Šä»‹ç»äº†bluestoreçš„æ¶æ„ã€ç›¸å…³å…ƒæ•°æ®åŠå†…éƒ¨I/Oæ˜ å°„çš„é€»è¾‘ï¼Œè¿™è¿˜åªæ˜¯bluestoreçš„å†°å±±ä¸€è§’ï¼Œåç»­ä¼šé™†ç»­å¯¹bluestoreçš„å¤„ç†æµç¨‹ã€ç©ºé—´åˆ†é…å™¨ã€ç¼“å­˜ç®¡ç†ã€å‹ç¼©ç­‰å®ç°è¿›è¡Œåˆ†æã€‚\n","permalink":"https://zhxin.xyz/post/ceph_bluestore_summary/","summary":"è½¬è½½è‡ªsysnote,å¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤ cephåç«¯æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œä»¥æ’ä»¶å¼çš„æ–¹å¼æ¥è¿›è¡Œç®¡ç†ä½¿ç”¨ï¼Œç›®å‰æ”¯æŒfilestoreï¼Œkvstor","title":"ã€è½¬è½½ã€‘cephå­˜å‚¨å¼•æ“bluestoreè§£æ"},{"content":"å·¥ä½œä¸­é‡åˆ°çš„æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤,ç‰¹æ­¤æ•´ç†ä»¥å¤‡å¿˜.\næŸ¥çœ‹é›†ç¾¤çŠ¶æ€ 1 2 3 4 ceph -s #æŸ¥çœ‹çŠ¶æ€ ceph -v #æŸ¥çœ‹ç‰ˆæœ¬ ceph df #æŸ¥è¯¢é›†ç¾¤å­˜å‚¨å®¹é‡ ceph health detail #é›†ç¾¤è¯¦ç»†å¥åº·ä¿¡æ¯ æŸ¥è¯¢é›†ç¾¤ç»„ä»¶ä¿¡æ¯ç›¸å…³å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 rados lspools #æŸ¥è¯¢æ± å­åˆ—è¡¨ ceph osd dump | grep pool #æŸ¥è¯¢æ‰€æœ‰æ± å­ä¿¡æ¯ rados -p \u0026lt;pool\u0026gt; ls #æ± å­ä¸‹å¯¹è±¡ rados --pgid \u0026lt;pgid\u0026gt; ls #æŸ¥çœ‹pgä¸‹å¯¹è±¡ ceph osd map \u0026lt;pool\u0026gt; object #æŸ¥çœ‹å¯¹è±¡ä¿¡æ¯ ceph-objectstore-tool --data-path \u0026lt;datapath\u0026gt; --journal-path \u0026lt;journalpath\u0026gt; \u0026lt;objname\u0026gt; dump #è¾“å‡ºå¯¹è±¡å…ƒæ•°æ®ä¿¡æ¯ ceph-admin-disktool --getdisks #è·å–ç£ç›˜ä¿¡æ¯ #monä¿¡æ¯ ceph mon stat ceph mon dump ceph quorum_status #osdä¿¡æ¯ ceph osd tree ceph osd dump ceph osd find \u0026lt;numeric_osd_id\u0026gt; ceph osd df tree #æŸ¥çœ‹é›†ç¾¤ç©ºé—´ä½¿ç”¨ç‡ #pgä¿¡æ¯ ceph pg stat ceph pg dump ceph pg dump_stuck unclean systemctlç®¡ç†æœåŠ¡ 1 2 3 4 5 systemctl reset-failed ceph-osd@* #é‡ç½®å¤±è´¥æœåŠ¡ systemctl start ceph-osd.target #é‡å¯osdæœåŠ¡ systemctl restart ceph.target #é‡å¯cephæœåŠ¡ systemctl stop ceph-osd@0 #åœæ­¢å•ä¸ªosdæœåŠ¡ systemctl status ceph-osd@1 #æŸ¥çœ‹æœåŠ¡çŠ¶æ€ é›†ç¾¤æ“ä½œå‘½ä»¤ 1 2 3 ceph osd pool delete \u0026lt;pool\u0026gt; \u0026lt;pool\u0026gt; --yes-i-really-really-mean-it #åˆ é™¤æ±  rados put \u0026lt;oid\u0026gt; \u0026lt;filename\u0026gt; --pool=\u0026lt;pool\u0026gt; #åœ¨æ± ä¸­æ·»åŠ å¯¹è±¡ eph osd pool create \u0026lt;pool\u0026gt; \u0026lt;pgnum\u0026gt; \u0026lt;pgnum\u0026gt; -r \u0026lt;hostã€osd\u0026gt; #åˆ›å»ºæ±  crushç›¸å…³æ“ä½œ 1 2 3 4 5 6 7 8 9 ceph osd crush dump ceph osd crush rule list ceph osd crush rule dump \u0026lt;crush rule name\u0026gt; #åœ¨çº¿ä¿®æ”¹crush rule ceph osd getcrushmap -o \u0026lt;map_old\u0026gt; #å¯¼å‡ºmap crushtool -d \u0026lt;map_old\u0026gt; -o \u0026lt;map_old.txt\u0026gt; #è½¬åŒ–æˆå¯ç¼–è¾‘æ ¼å¼ vi map_old.txt #ä¿®æ”¹rule replicated_ruleset step chooseleaf firstn 0 type *osd* crushtool -c \u0026lt;map_old.txt\u0026gt; -o \u0026lt;map_new\u0026gt; #è¿˜åŸä¸ºmap ceph osd setcrushmap -i \u0026lt;map_new\u0026gt; #å°†mapå¯¼å…¥ceph å—è®¾å¤‡ç®¡ç†å‘½ä»¤ 1 2 3 4 5 6 7 ceph osd pool create \u0026lt;rbd\u0026gt; \u0026lt;pgnum\u0026gt; \u0026lt;pgnum\u0026gt; ceph osd pool set \u0026lt;rbd\u0026gt; size \u0026lt;repnum\u0026gt; rbd create --image \u0026lt;my_image\u0026gt; --size \u0026lt;1T\u0026gt; --pool \u0026lt;rbd\u0026gt; rbd ls -p \u0026lt;pool_name\u0026gt; #æŸ¥çœ‹æŒ‡å®špoolä¸­çš„å· rbd trash move/mv \u0026lt;images_name\u0026gt; -p \u0026lt;pool_name\u0026gt; #å°†å·ä¸¢åˆ°å›æ”¶ç«™ rbd trash restore \u0026lt;ID\u0026gt; -p \u0026lt;pool_name\u0026gt; #å°†å›æ”¶ç«™ä¸­çš„å·è¿˜åŸ rbd trash remove/rm \u0026lt;ID\u0026gt; -p \u0026lt;pool_name\u0026gt; #æ¸…é™¤å›æ”¶ç«™ä¸­çš„å· é…ç½®å‘½ä»¤ 1 2 3 4 5 6 ceph --show-config #æŸ¥è¯¢é›†ç¾¤é»˜è®¤é…ç½® ceph daemon \u0026lt;mon.5\u0026gt; config show | grep \u0026lt;mon_osd_down_out_interval\u0026gt; #æŸ¥è¯¢è¿›ç¨‹é…ç½®ä¿¡æ¯ #ä¿®æ”¹è¿è¡Œé…ç½®ä¿¡æ¯ ä¸´æ—¶ç”Ÿæ•ˆ ceph tell \u0026lt;daemon-type\u0026gt;.\u0026lt;daemon id or *\u0026gt; injectargs --\u0026lt;name\u0026gt; \u0026lt;value\u0026gt; ceph tell osd.0 injectargs \u0026#39;--debug-osd 0/5\u0026#39; å…¶ä»– å‡ºç°ç”±äºmonæœåŠ¡æ²¡æœ‰èµ·æ¥å¯¼è‡´çš„admin_socketé—®é¢˜ï¼Œå¯èƒ½åŸå› æ˜¯monå¯¹æ‰€åœ¨åˆ†åŒºç›®å½•ç©ºé—´çš„è¦æ±‚ä¸æ»¡è¶³(é»˜è®¤5%ï¼‰æ¸…é™¤éƒ¨åˆ†ç©ºé—´å³å¯; ","permalink":"https://zhxin.xyz/post/ceph%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","summary":"\u003cp\u003eå·¥ä½œä¸­é‡åˆ°çš„æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤,ç‰¹æ­¤æ•´ç†ä»¥å¤‡å¿˜.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæŸ¥çœ‹é›†ç¾¤çŠ¶æ€\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eceph -s \u003cspan class=\"c1\"\u003e#æŸ¥çœ‹çŠ¶æ€\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eceph -v \u003cspan class=\"c1\"\u003e#æŸ¥çœ‹ç‰ˆæœ¬\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eceph df \u003cspan class=\"c1\"\u003e#æŸ¥è¯¢é›†ç¾¤å­˜å‚¨å®¹é‡\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eceph health detail \u003cspan class=\"c1\"\u003e#é›†ç¾¤è¯¦ç»†å¥åº·ä¿¡æ¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"å¸¸ç”¨cephå‘½ä»¤"},{"content":" ä½ å¾ˆè‡ªç”±,è€Œå¥¹å´æ˜¯å›šå¾’\nåœ¨çœ‹äº†å››é›†HBOæ‹çš„ æˆ‘çš„å¤©æ‰å¥³å‹ çš„å‰§ä¹‹å,å°±è¿«ä¸åŠå¾…çš„æŠ±èµ·ä¹¦æ¥çœ‹äº†.ä¹‹å‰å¹¶æ²¡æœ‰å¬è¿‡è¿™æœ¬ä¹¦,ä¹Ÿæ²¡æœ‰äº†è§£è¿‡åŸƒè±å¨œè´¹å…°ç‰¹è¿™ä¸ªä½œå®¶,çº¯ç²¹åªæ˜¯æœ€è¿‘åœ¨å¾®åšä¸Šçœ‹åˆ°å¾ˆå¤šäººåœ¨æ¨èè¿™éƒ¨å‰§,å°±å¥½å¥‡æ¥çœ‹.è¿½å®Œæ›´æ–°ä¹‹å,è¦ä¸€å‘¨çš„æ—¶é—´æ‰èƒ½çœ‹åˆ°ä¸‹ä¸€é›†(åœ¨è¿™æ–¹é¢ä¸å¾—ä¸å¤¸å¥–Netflix),æ²¡è€å¿ƒå°±å»kindleä¸Šä¸‹è½½äº†ä¹¦,èŠ±äº†å¤§æ¦‚ä¸‰å‘¨çš„æ—¶é—´æŠŠé‚£ä¸å‹’æ–¯å››éƒ¨æ›²ç»™çœ‹å®Œ.\næ•…äº‹è®²è¿°çš„æ˜¯è‰å¨œå’Œè±å†œä¸¤ä¸ªå¥³å­©ä»ç«¥å¹´åˆ°è€å¹´æŒç»­ä¸€ç”Ÿçš„æ•…äº‹,å¥¹ä»¬æ˜¯æœ‹å‹ä¹Ÿæ˜¯å¯¹æ‰‹,æœ‰æ¸©æƒ…ä¹Ÿä¸ä¹å†·æ¼ ,å¥¹ä»¬äº’ä¸ºå½±å­å´åˆè¿¥ç„¶ä¸åŒ.ä¹¦ä¸­ä»¥è±å†œçš„è§†è§’è®²è¿°ä¸¤äººçš„æ•…äº‹,è‰å¨œæ˜¯å¥¹ä»¬åŸåŒºå…¬è®¤çš„æœ€èªæ˜çš„å­©å­,åœ¨å°å­¦å¤§å®¶è¿˜éƒ½åœ¨å­¦å­—æ¯çš„æ—¶å€™å¥¹å°±å·²ç»åœ¨æ²¡äººæ•™çš„æƒ…å†µä¸‹ä¼šè¯†å­—äº†,è¿™è®©åŒ…æ‹¬è±å†œåœ¨å†…çš„å…¶ä»–å­¦ç”Ÿéƒ½ç›¸å½¢è§ç»Œ.è‰å¨œèº«ä¸Šæœ‰ä¸œè¥¿åœ¨å¸å¼•ç€è±å†œ,ä¸¤äººç›¸äº’è¯•æ¢æ…¢æ…¢æ¥è¿‘æœ€ç»ˆæˆä¸ºäº†æœ‹å‹.è±å†œåœ¨è€å¸ˆå¿ƒç›®ä¸­çš„åœ°ä½è¢«è‰å¨œå–ä»£,è™½ç„¶å¿ƒæ€€å¤±è½ä¸å«‰å¦’ä½†æ˜¯å› ä¸ºè¾“ç»™çš„æ˜¯è‰å¨œ,è±å†œæ¸æ¸ä¹Ÿå°±æ²¡é‚£ä¹ˆéš¾è¿‡,ç”šè‡³ä¼šæ‰¿è®¤è‡ªå·±ç¡®å®æ²¡æœ‰è‰å¨œèªæ˜è€Œç”˜å¿ƒè¿½é€ç¬¬äºŒåçš„ä½ç½®.ä¸¤äººä¸€èµ·åšäº†å¾ˆå¤šäº‹,æ‰¾å ‚é˜¿å¥‡å‹’è®¨å¨ƒå¨ƒ;ä¹° å°å¦‡äºº ä¸€èµ·çœ‹æƒ³ç€é æ–‡å­—æŒ£å¾ˆå¤šé’±;ä¸€èµ·èµ°è¿‡åŸåŒºéš§é“å»çœ‹å¤§æµ·ç­‰ç­‰.ä¸¤äººé‡è¦çš„ä¸€ä¸ªåˆ†æ°´å²­æ˜¯åœ¨å°å­¦æ¯•ä¸šæ˜¯å¦ç»§ç»­ä¸Šå­¦çš„é—®é¢˜,è±å†œç»è¿‡æ›²æŠ˜æœ€ç»ˆè¢«å®¶é‡Œå…è®¸ç»§ç»­ä¸Šå­¦,è€Œè‰å¨œå´è¢«è¦æ±‚å¸®å®¶é‡Œå¹²æ´»,è‰å¨œåœ¨åæŠ—è¿‡ç¨‹ä¸­ç”šè‡³è¢«çˆ¸çˆ¸æ‰”å‡ºçª—å¤–.æœ€ç»ˆè±å†œè¿›è¡Œä¸Šå­¦,ä¸Šå®Œåˆä¸­ä¸Šé«˜ä¸­æœ€åç”šè‡³è¯»å®Œäº†å¤§å­¦,ä½†æ˜¯è‰å¨œå´ä¸å¾—ä¸åœ¨å®¶é‡Œçš„é‹åº—å¸®å¿™,ä½†æ˜¯è‰å¨œè‡ªèº«çš„é­”åŠ›å¹¶æ²¡æœ‰å› ä¸ºæ²¡ä¸Šå­¦è€Œæ¶ˆå¤±,åè€Œåœ¨åŸåŒºé‡Œé¢ä¸æ–­å½°æ˜¾è‡ªå·±çš„é­…åŠ›.ä¸€å¼€å§‹è‰å¨œå¹¶æ²¡æœ‰æ”¾å¼ƒå­¦ä¹ è¿˜åœ¨å’Œè±å†œç«äº‰,ä½ å­¦æ„å¤§åˆ©è¯­æˆ‘ä¹Ÿå­¦æ„å¤§åˆ©è¯­,ä½ å­¦å¸Œè…Šè¯­æˆ‘å°±å­¦å¸Œè…Šè¯­ç”šè‡³è¦æ¯”ä½ å­¦çš„æ—©å­¦çš„æ›´å¥½,ä¸¤äººè¿˜åœ¨ä¸æ–­çš„ç«äº‰,è€Œä¸€æ®µæ—¶é—´ä¹‹åè‰å¨œè‡´åŠ›äºå¸®åŠ©å“¥å“¥é‡Œè¯ºå‘è´¢,è‰å¨œè®¾è®¡å‡ºæ¬¾å¼æ–°é¢–çš„çš®é‹å’Œå“¥å“¥ä¸€èµ·åš,æœ€ç»ˆçš®é‹å¸®åŠ©è‚‰é£Ÿåº—è€æ¿æ–¯ç‰¹å‡¡è¯ºå’Œç´¢æ‹‰æ‹‰å…„å¼Ÿå‘äº†ä¸å°çš„è´¢,åŒæ—¶è‰å¨œåŒæ—¶è¢«æ–¯ç‰¹å‡¡è¯ºå’Œç´¢æ‹‰æ‹‰å®¶çš„é©¬å°”åˆ‡è¯ºè¿½æ±‚,è‰å¨œè®¨åŒç´¢æ‹‰æ‹‰,æƒ³é æ–¯ç‰¹å‡¡è¯ºæ‹œæ‰˜é©¬å°”åˆ‡è¯º,å¥¹ä»¥ä¸ºæ–¯ç‰¹å‡¡è¯ºæ˜¯ä¸ä¸€æ ·çš„,ç¡®ä¸æ–™æ–¯ç‰¹å‡¡è¯ºä¸ºäº†çš®é‹çš„ç”Ÿæ„å’Œç´¢æ‹‰æ‹‰å®¶çš„äººè¾¾æˆäº†åˆä½œ,ä½†æ˜¯è‰å¨œæœ€ç»ˆè¿˜æ˜¯å«ç»™äº†æ–¯ç‰¹å‡¡è¯ºå¼€å§‹äº†ä¸€æ®µå¤±è´¥çš„å©šå§»\u0026hellip;.\nè¿™åŸºæœ¬æ˜¯å››éƒ¨æ›²ç¬¬ä¸€éƒ¨ æˆ‘çš„å¤©æ‰å¥³å‹ çš„å‰§æƒ…,ç¬¬äºŒéƒ¨ æ–°åå­—çš„æ•…äº‹ è®²è¿°çš„æ˜¯è‰å¨œæˆä¸ºäº†å¡æ‹‰å¥‡å¤ªå¤ªä¹‹åå‘ç”Ÿçš„æ•…äº‹,åŒ…æ‹¬è‰å¨œè¢«æ–¯ç‰¹å‡¡è¯ºå®¶æš´,æµäº§,æ–°å¼€ä¸€å®¶è‚‰é£Ÿåº—ç­‰ç­‰,è€Œæœ€é‡è¦çš„æ˜¯å’Œå°¼è¯ºè¨æ‹‰æ‰˜é›·çš„å©šå¤–æƒ…,å°¼è¯ºæ˜¯è±å†œçš„æš—æ‹å¯¹è±¡,æœ€åå’Œå°¼è¯ºä¸€èµ·å‡ºé€ƒç”šè‡³æ€€å­•ç”Ÿä¸‹äº†ä¸€ä¸ªå„¿å­,ä½†æ˜¯å°¼è¯ºå´æœ€åæ”¾å¼ƒäº†æ”¾å¼ƒäº†è‰å¨œå‡ºé€ƒäº†,è±å†œå¤§å­¦æ¯•ä¸šåå‡ºç‰ˆäº†ä¸€æœ¬ä¹¦æˆä¸ºäº†ä½œå®¶. ç¬¬ä¸‰éƒ¨ ç¦»å¼€çš„ ç•™ä¸‹çš„ è®²è¿°çš„æ˜¯è‰å¨œæœ€ç»ˆç¦»å¼€äº†æ–¯ç‰¹å‡¡è¯ºå’Œæ©ä½åœ¨äº†ä¸€èµ·,å¸¦ç€å’Œå°¼è¯ºç”Ÿçš„å´é•¿å¾—è¶Šæ¥è¶Šåƒæ–¯ç‰¹å‡¡è¯ºçš„å­©å­,ä¸¤äººä¸€èµ·å­¦ä¹ è®¡ç®—æœºæŠ€æœ¯,æœ€åè¿˜å¼€äº†ä¸€å®¶BASIC SIGHTå…¬å¸,è±å†œå’Œå¾ˆæœ‰å£°æœ›çš„è‰¾ç½—å¡”å®¶æ—çš„å„¿å­å½¼å¾—ç½—ç»“å©šäº†ç”Ÿäº†ä¸¤ä¸ªå¥³å„¿,ä½†æ˜¯ç‹—è¡€çš„æ˜¯è±å†œå’Œå°¼è¯ºåˆè§é¢äº†ä¸¤äººè¿˜åœ¨ä¸€èµ·ç”Ÿäº†ä¸ªå¥³å„¿.ç¬¬å››éƒ¨ å¤±è¸ªçš„å­©å­ è®²è¿°çš„æ˜¯è±å†œå’Œå°¼è¯ºåœ¨ä¸€èµ·ä¹‹åå’Œå½¼å¾—ç½—ç¦»å©šäº†,ä½†æ˜¯å°¼è¯ºå´æ¬ºéª—äº†è±å†œè‡ªå·±æ²¡æœ‰ç»“å©šè¿˜é ç€èº«è¾¹çš„å¥³äººäº‰å–è¿™ç¤¾ä¼šçš„åœ°ä½,åœ¨è‰å¨œçš„å¸®åŠ©ä¸‹è±å†œæœ€ç»ˆçœ‹ç ´äº†å°¼è¯º,å’Œä»–åˆ†å¼€äº†,å¹¶æ¬åˆ°äº†è‰å¨œå’Œæ©ä½çš„æ¥¼ä¸Šå’Œä»–ä»¬ä¸€å®¶äººä½åœ¨äº†ä¸€èµ·,è¿™çŸ­æ—¶é—´è²Œä¼¼æ˜¯ä¸¤äººå…³ç³»æ¯”è¾ƒå’Œè°çš„ä¸€æ®µæ—¶é—´,ä½†æ˜¯æŸä¸€å¤©è‰å¨œå’Œæ©ä½ç”Ÿçš„å¥³å„¿,è’‚å¨œ,çªç„¶æ¶ˆå¤±äº†,è‰å¨œå› æ­¤å‡ ä¹å´©æºƒäº†,å­©å­æœ€ç»ˆéƒ½æ‰¾ä¸åˆ°,è€Œåå‡ å¹´åè±å†œæ¬åˆ°äº†éƒ½çµ,çªç„¶æœ‰ä¸€å¤©è‰å¨œçªç„¶æŠŠè‡ªå·±ä»æ—¶é—´ä¸Šå›è½¦åˆ é™¤äº†,æŠ¹é™¤äº†è‡ªå·±åœ¨ä¸–ä¸Šçš„ç—•è¿¹,è€Œè±å†œåˆ™å†™ä¸‹äº†è¿™éƒ¨ä¹¦.\nä¸Šé¢çš„ç®€ä»‹å‰§é€äº†ä¸å°‘ä¸œè¥¿ä½†å¿½ç•¥çš„ä¸œè¥¿æ›´å¤š, é‚£ä¸å‹’æ–¯å››éƒ¨æ›² æ˜¯æ¯”è¾ƒåºå¤§çš„è‘—ä½œ,ä»¥é‚£ä¸å‹’æ–¯ä¸ºèƒŒæ™¯,ä¸ä»…å±•ç°äº†ä¸¤ä¸ªå¥³äººæŒç»­ä¸€ç”Ÿçš„å‹è°Š,æ›´å±•ç¤ºäº†æ„å¤§åˆ©åŠä¸ªä¸–çºªçš„ç¤¾ä¼šåŠ¨è¡,æ”¿æ²»æ€æ½®çš„å˜åŒ–,éšç€è±å†œçš„æˆé•¿è®¨è®ºäº†å¾ˆå¤šå…±äº§ä¸»ä¹‰,å®—æ•™,æ°‘ä¸»,å¥³æƒä¸»ä¹‰ç­‰ç­‰å†…å®¹.è¿™å››æœ¬ä¹¦æˆ‘ä¾ç…§è‡ªå·±å–œæ¬¢çš„ç¨‹åº¦è¿›è¡Œæ’åæ˜¯äºŒä¸‰ä¸€å››.è¯»ç¬¬å››éƒ¨çš„æ—¶å€™ä¸€åº¦æƒ³æ‘”ä¹¦,è¢«å°¼è¯ºçš„æ¸£ã€è±å†œçš„å¿ç»™æ°”çš„æš´è·³.å°¼è¯ºæ›¾é„™è§†è‡ªå·±çš„çˆ¶äº²ä½†æ˜¯å°¼è¯ºæ¯”ä»–çˆ¶äº²æœ‰è¿‡ä¹‹è€Œæ— ä¸åŠ,åœ¨å°¼è¯ºæ¬ºéª—çš„ä¼—å¤šå¥³äººä¸­åªæœ‰è‰å¨œæ˜¯è¯†ç ´å°¼è¯ºä¹‹åæ¯”è¾ƒåšå†³çš„æ‹’ç»çš„,å¹¶å¸®åŠ©è±å†œä¸è®©å¥¹å†è‡ªæ¬ºæ¬ºäºº.åœ¨ä¼—å¤šçš„é…è§’ä¸­,ä¸ªäººæ„Ÿè§‰åˆ»ç”»æœ€ç”ŸåŠ¨çš„æ˜¯è±å†œçš„æ¯äº²,ä¸€ä¸ªå¼ºåŠ¿,æš´èº,è‡ªå°Šå¿ƒå¼ºçš„æ¯äº²å½¢è±¡.è±å†œæ¯äº²åœ¨æœ€åç”Ÿç—…çš„æ—¶å€™è¯´è‡ªå·±æŠŠå…¨éƒ¨çš„å…³å¿ƒä¸æœŸå¾…éƒ½æ”¾åˆ°äº†è±å†œçš„èº«ä¸Šä»¥è‡´å¿½ç•¥äº†è±å†œçš„å¦¹å¦¹å¼Ÿå¼Ÿ,è±å†œè·å¾—çš„ä¸€åˆ‡æˆå°±å¥¹éƒ½è§‰å¾—æ˜¯è‡ªå·±çš„åŠŸåŠ³: ä½ å¾—åˆ°çš„ä¸€åˆ‡éƒ½æ˜¯æˆ‘çš„. è±å†œæ¯äº²å¯¹è±å†œçš„çˆ±å¾ˆæ·±ä¹Ÿå¾ˆéšæ™¦,åŒæ—¶å¯¹è±å†œçš„æ€¨ä¸åˆ‡ä¹Ÿä¸é‘å¤šè®©.å¥¹åšæŒè®©è±å†œè¯»ä¹¦ä½†ä¹ŸæŠ±æ€¨è±å†œä¸èƒ½å·¥ä½œæŒ£é’±,å¥¹ä¼šåœ¨è±å†œå‘çƒ§å›ä¸äº†å®¶ç‹¬è‡ªè¿ˆç€ä¸€ç˜¸ä¸€æ‹çš„è…¿å»åˆ°è±å†œå¤§å­¦çš„åŸå¸‚å»çœ‹å¥¹,å¥¹ä¼šå½“é¢æŠ±æ€¨è±å†œä¸å¦‚è‰å¨œä½†æ˜¯åˆæ—¶æ—¶åˆ»åˆ»ç»´æŠ¤è‡ªå·±çš„å¥³å„¿æ˜¯æœ€æœ‰å‡ºæ¯çš„,è±å†œæ˜¯å¥¹åœ¨åŸåŒºæ˜‚é¦–æŒºèƒ¸è¡Œèµ°çš„è‡ªä¿¡æºæ³‰,å¥¹å–å¤šé…’ä¹Ÿä¼šæš´éœ²è‡ªå·±ä½çº§åº¸ä¿—çš„ä¹è¶£ä½†æ˜¯åœ¨è±å†œä¸ˆå¤«å½¼å¾—ç½—é¢å‰å¥¹å§‹ç»ˆåšæŒç»´æŒç«¯åº„è‡ªå°Šçš„å½¢è±¡.è±å†œæ¯äº²æ˜¯ä¸ªå¾ˆçŸ›ç›¾çš„è§’è‰²,ä¹Ÿæ­£å› ä¸ºå…¶çŸ›ç›¾æ‰€ä»¥æ˜¾å¾—çœŸå®æ˜¾å¾—å¯çˆ±.è±å†œä¸€åº¦ä»¥æ¯äº²è‚¥å¤§çš„å±è‚¡ä¸°æ»¡çš„èƒ¸è„¯ç˜¸æ‹çš„åŒè…¿ä¸ºè€»,ä½†æ˜¯è±å†œåœ¨æ¯äº²å»ä¸–ä¹‹å,æ„¿æ„è¿™äº›ç‰¹å¾åœ¨è‡ªå·±èº«ä¸Šèƒ½å¤Ÿæ˜¾ç°,ä½œä¸ºæ¯äº²åœ¨è‡ªå·±èº«ä¸Šçš„æŠ•å½±.\nè¿™å››éƒ¨æ›²ä¸­ä¹Ÿæœ‰ç±»ä¼¼çº¢æ¥¼æ¢¦ä¸­è‰ç°è›‡çº¿,ä¼å»¶åƒé‡Œçš„å†™æ³•. å°æ—¶å€™çš„å¾ˆå¤šäº‹æƒ…æˆäº†ä»¥åå‘ç”Ÿçš„äº‹çš„éšå–». æ¯”å¦‚è‰å¨œå’Œè±å†œå°æ—¶å€™äº¤æ¢å¨ƒå¨ƒå¹¶å°†å¯¹æ–¹çš„å¨ƒå¨ƒä¸¢æ‰, å¥¹ä»¬ä»¥ååœ¨åˆ†åˆ«æ€€äº†æ©ä½å’Œå°¼è¯ºå­©å­çš„æ—¶å€™å¼€ç©ç¬‘è¯´è¦äº¤æ¢å­©å­æŠšå…»,è‰å¨œçš„å¥³å„¿ç”šè‡³å’Œè±å†œå½“åˆçš„å¨ƒå¨ƒä¸€æ ·éƒ½å«è’‚å¨œ,è±å†œåœ¨å¤šå¹´ä»¥åé‡æ–°æ”¶åˆ°äº†ä¸¤ä¸ªå¨ƒå¨ƒ,ä½†æ˜¯è’‚å¨œå´å§‹ç»ˆæ²¡æœ‰å›æ¥; åœ¨å°æ—¶å€™è¯¾å ‚ç«èµ›æ—¶è‰å¨œå’Œæ©ä½è¡¨ç°å‡ºæ•°å­¦ä¸Šçš„å¤©åˆ†,è€Œä»–ä»¬ä»¥ååœ¨ä¸€èµ·å­¦ä¹ è®¡ç®—æœºè¿˜å¼€äº†å®¶å…¬å¸;å°æ—¶å€™è‰å¨œæ€‚æ¿è±å†œå‡ºåŸå»çœ‹æµ·,èµ°åˆ°ä¸€åŠè‰å¨œæƒ³å›å»äº†è€Œè±å†œå´æƒ³ç»§ç»­å‰è¿›,åœ¨å¥¹ä»¬ä»¥åçš„äººç”Ÿä¸­,è‰å¨œä»æ¥æ²¡æœ‰å‡ºå»è¿‡é‚£ä¸å‹’æ–¯ä¹‹å¤–çš„åœ°æ–¹è€Œè±å†œå´åœ¨å…¨ä¸–ç•Œæ¸¸èµ°,æœ€åè¿˜å®šå±…éƒ½çµ,ä¸çŸ¥é“åœ¨è‰å¨œå°†è‡ªå·±åœ¨ä¸–é—´æŠ¹é™¤ä¹‹åæœ‰æ²¡æœ‰å‡ºèµ°é‚£ä¸å‹’æ–¯,å»èµ°å‘æ›´å¹¿é˜”çš„ä¸–ç•Œ.è‰å¨œå’Œè±å†œç›¸äº’ç¾ç»Š,äº’ä¸ºå½±å­,è‰å¨œå°†è±å†œçœ‹æˆç»§ç»­æ±‚å­¦çš„è‡ªå·±,è®©è±å†œæ›¿è‡ªå·±å­¦ä¹ æ›¿è‡ªå·±å»çœ‹ä¸–ç•Œ,å¥¹è¦æ±‚è±å†œå¿…é¡»æ˜¯æœ€å¥½çš„,è¯´è¿‡ ä½ å¦‚æœä¸æ˜¯æœ€å¥½çš„,é‚£æˆ‘æ˜¯è°,æˆ‘æ€ä¹ˆåŠ ç±»ä¼¼è¿™æ ·çš„è¯ ,è‰å¨œä»æ¥æ²¡æœ‰æƒ³è¦å’Œè±å†œæ–­ç»å…³ç³»,ç”šè‡³åœ¨è±å†œå’Œå°¼è¯ºåœ¨ä¸€èµ·æ—¶ä¸æ–­çš„ä¸»åŠ¨å»æ‰¾è±å†œ,å¸®è±å†œè¯†åˆ«å°¼è¯ºè™šä¼ªçš„é¢ç›®. è€Œå¯¹è±å†œæ¥è¯´,è‰å¨œæ›´åƒæ˜¯è‡ªå·±å­¦ä¹ çš„åŠ¨åŠ›,æ˜¯è‡ªå·±çš„ä¸è‡ªä¿¡,æ˜¯ä»…ä»…é€šè¿‡è°ˆè¯å°±èƒ½è·å¾—å†™ä½œçµæ„Ÿä¸å†™ä½œæŠ€å·§çš„å¯¹è±¡.è±å†œå¯¹è‰å¨œæ˜¯åˆçˆ±åˆæ€•,çˆ±è‰å¨œçš„èªæ˜æœ‰é­…åŠ›,å®³æ€•å¯¹è‰å¨œçš„å«‰å¦’ä¸ä¸å¦‚è®©è‡ªå·±ä¸§å¤±è‡ªä¿¡,å˜æˆè‰å¨œçš„å½±å­è¿›è€Œä¸§å¤±è‡ªæˆ‘.æ¯å½“è±å†œæ„Ÿè§‰è‡ªå·±å·²ç»è¿œè¿œæŠŠè½åçš„åŸåŒºæŠŠåªæœ‰å°å­¦å­¦å†çš„è‰å¨œè¿œè¿œç”©åœ¨åé¢çš„æ—¶å€™,è‰å¨œæ€»æœ‰åŠæ³•è®©è±å†œæ„Ÿè§‰åˆ°è‡ªå·±å‘å¾®ä¸æ— çŸ¥,åœ¨ä¸¤äººçš„ç«äº‰ä¸­è±å†œå¹¶æ²¡æœ‰èµ¢.ç”±äºå°è¯´æ˜¯ä»¥è±å†œçš„è§†è§’å†™çš„,æ‰€ä»¥è¯»è€…èƒ½å¤Ÿäº†è§£è±å†œçš„å¿ƒç†å´åªèƒ½å’Œè±å†œä¸€èµ·å»æ£æµ‹è‰å¨œçš„å¿ƒç†,è®©è‰å¨œæ›´å¤šäº†ä¸€å±‚ç¥ç§˜ä¸ä¼ å¥‡.\nå°è¯´è¿˜æ˜¯æ¯”è¾ƒç²¾å½©çš„,è¯»åˆ°æ ¹æœ¬åœä¸ä¸‹æ¥,å››æ˜Ÿæ¨è.\n","permalink":"https://zhxin.xyz/post/my_briliant_friend/","summary":"ä½ å¾ˆè‡ªç”±,è€Œå¥¹å´æ˜¯å›šå¾’ åœ¨çœ‹äº†å››é›†HBOæ‹çš„ æˆ‘çš„å¤©æ‰å¥³å‹ çš„å‰§ä¹‹å,å°±è¿«ä¸åŠå¾…çš„æŠ±èµ·ä¹¦æ¥çœ‹äº†.ä¹‹å‰å¹¶æ²¡æœ‰å¬è¿‡è¿™æœ¬ä¹¦,ä¹Ÿæ²¡æœ‰äº†è§£è¿‡åŸƒè±å¨œè´¹å…°ç‰¹è¿™ä¸ª","title":"æˆ‘çš„å¤©æ‰å¥³å‹è¯»åæ„Ÿ"},{"content":"åº”è¯¥æ˜¯å¤§äºŒæˆ–è€…å¤§ä¸‰çš„æ—¶å€™ç¬¬ä¸€æ¬¡çœ‹æ˜¯æè£•å’Œå¯¼æ¼”çš„ç”µå½±ã€Šæ— äººçŸ¥æ™“ã€‹ã€‚å½“æ—¶å¥½åƒæ˜¯çœ‹äº†ä¸€ç¯‡æ–‡ç« ï¼Œä»‹ç»è¯´æŸ³ä¹ä¼˜å¼¥å‡­å€Ÿè¯¥ç‰‡å‡»è´¥ã€ŠèŠ±æ ·å¹´åã€‹æ¢æœä¼Ÿæˆä¸ºäº†æˆ›çº³å†å²ä¸Šæœ€å¹´è½»çš„å½±å¸ã€‚æ–‡ç« è‡ªç„¶æœ‰ä»¥æ­¤ä¸ºå™±å¤´å¸å¼•çœ¼çƒçš„å«Œç–‘ï¼Œä¸è¿‡è¿˜æ˜¯è·å¾—äº†æˆ‘çš„å¥½å¥‡ã€‚å½“æ—¶å’Œå¤§å¤šæ•°äººä¸€æ ·ï¼Œæ–°è¿‘å¬è¯´äº†ä¸€éƒ¨ç”µå½±æ€»è¦åˆ°è±†ç“£ç”µå½±çœ‹çœ‹è¯„åˆ†å½±è¯„ä»€ä¹ˆçš„ï¼ŒæƒŠå¥‡çš„æ˜¯åœ¨è±†ç“£ä¸Šæ˜¯æè£•å’Œå¯¼æ¼”æ‰€æœ‰ä½œå“ç«Ÿç„¶å¤§å¤šéƒ½æ˜¯å…«åˆ†å¤šçš„æ ·å­ã€‚å°±è¿™æ ·ï¼Œæˆ‘æœ‰æ„çš„å¤šæ‰¾äº†å‡ éƒ¨æ˜¯æè£•å’Œçš„ä½œå“æ¥çœ‹ã€‚\næ˜¯æè£•å’Œçš„ç”µå½±ä¸€èˆ¬æ˜¯åæ–‡è‰ºçš„ï¼Œå…³æ³¨å®¶åº­ä¼¦ç†ï¼ŒèŠ‚å¥ç¼“æ…¢ã€æ³¨é‡æƒ…æ„Ÿçš„ç§¯ç´¯ã€‚æ˜¯ä¸æ˜¯æ„Ÿè§‰ä¼¼æ›¾ç›¸è¯†ï¼Ÿåƒå±±ç”°æ´‹æ¬¡ï¼Œåƒå°æ´¥å®‰äºŒéƒã€‚æ˜¯æè£•å’Œè‡ªå·±å€’è¯´è¿‡è‡ªå·±å—æˆæ¿‘å·³å–œç”·å½±å“æ¯”è¾ƒå¤šï¼Œå…¶å®åœ¨å®¶åº­ä¼¦ç†ç‰‡æ–¹é¢ï¼Œæ—¥æœ¬ä¸€ç›´æœ‰ç€ä¼˜ç§€çš„ä¼ æ‰¿ï¼Œå‘ä¸–ç•Œå±•ç¤ºä¸œæ–¹çš„å®¶åº­ä¼¦ç†è§‚ï¼Œé‚£ç§ä¸è¯´å‡ºæ¥è€Œå¯¹æ–¹éƒ½æ‡‚çš„ç»†è…»æƒ…æ„Ÿã€‚\næ— äººçŸ¥æ™“ã€‹è®²è¿°çš„æ˜¯ä¸€ä¸ªæ®‹å¿çš„æ•…äº‹ï¼Œæ¯äº²ç¦»å®¶å‡ºèµ°ä¸å½’ï¼Œå¤§å„¿å­è´Ÿè´£ç…§é¡¾ä¸‰ä¸ªå¼Ÿå¼Ÿå¦¹å¦¹ç­‰å¾…æ¯äº²å›æ¥ï¼Œä¸ºäº†ä¸è®©é‚»å±…å‘ç°ï¼Œä»–ä»¬å‡ ä¹æ•´æ—¥åœ°å¾…åœ¨å‡ºç§Ÿå±‹ä¸­ï¼Œæœ€åå¼Ÿå¼Ÿè¢«é¥¿æ­»ï¼Œå¤§å„¿å­ä¹˜åˆ—è½¦å°†å¼Ÿå¼ŸåŸ‹åœ¨å±±ä¸Šã€‚æ•…äº‹å¾ˆæ®‹é…·ï¼Œæ˜¯æè£•å’Œçš„é•œå¤´å´å¾ˆå†·é™å®¢è§‚ï¼Œå­©å­ä»¬çš„ä¸€é¢¦ä¸€ç¬‘ã€è¿·æƒ˜å¿§ä¼¤ï¼Œéƒ½æ•æ‰çš„å¾ˆåˆ°ä½ã€‚ä¹‹åè¿˜çœ‹äº†å¯¼æ¼”çš„ã€Šæ­¥å±¥ä¸åœã€‹ã€ã€Šå¥‡è¿¹ã€‹ï¼Œä¹Ÿæ˜¯ä»¥å®¶åº­ä¸ºä¸»é¢˜ï¼ŒèŠ‚å¥ä¸æ€¥ä¸ç¼“ï¼Œç”µå½±çš„é«˜æ½®åœ¨äºæƒ…æ„Ÿç´¯ç§¯åˆ°æŸä¸ªç¨‹åº¦çš„è¿¸å‘ã€‚æ€»çš„æ¥è¯´ï¼Œæ˜¯æå¯¼æ¼”çš„ç”µå½±å¤§å¤šçœ‹å®Œå¹¶ä¸ä¼šè®©äººæœ‰è½»æ¾çš„æ„Ÿè§‰ï¼Œåè€Œæ˜¯å¿ƒé‡Œé¢æ²‰ç”¸ç”¸çš„ï¼Œåƒè¢«å µå¡äº†ä»€ä¹ˆä¸œè¥¿ä¼¼çš„è®©äººé™·å…¥æ¯”è¾ƒé•¿çš„æƒ…ç»ªä½è½æœŸã€‚\nç”Ÿæ´»æ˜¯è¿™ä¹ˆæ®‹é…·åˆç¾å¥½ï¼Œæ²¡æœ‰å¸Œæœ›ï¼Œä¹Ÿæ²¡æœ‰ç»æœ›ï¼Œåªèƒ½æ„¿ä½ èƒ½å¤Ÿå®‰æŠšå¿ƒä¸­çš„è‹¦æ¥šï¼Œä¸€æ­¥ä¸€æ­¥çš„èµ°ä¸‹å»â€¦\næ˜¯æè£•å’Œæœ€è¿‘çš„å‡ éƒ¨å½±ç‰‡æ•…äº‹æ€§æœ‰æ‰€å¢å¼ºï¼Œæ›´å®¹æ˜“å¸å¼•äººçœ‹ä¸‹å»ï¼Œä¸æ¯”ä¹‹å‰çš„å½±ç‰‡æ¯”è¾ƒâ€œæ²‰é—·â€ã€‚ã€Šå¦‚çˆ¶å¦‚å­ã€‹è®²è¿°çš„æ˜¯ä¸¤ä¸ªå®¶åº­æŠ±é”™å­©å­çš„æ•…äº‹ï¼Œæ¢è®¨äº²æƒ…åˆ°åº•æ˜¯è¡€ç¼˜è¿˜æ˜¯é™ªä¼´ï¼›ã€Šæµ·è¡—æ—¥è®°ã€‹è®²è¿°çš„æ˜¯ä¸‰å§å¦¹æ¥çº³åŒçˆ¶å¼‚æ¯çš„å¦¹å¦¹çš„æ•…äº‹ï¼Œå½±ç‰‡æ‹æ‘„çš„å¾ˆç¾ï¼Œå››å§å¦¹éƒ½å¾ˆå‡ºå½©ï¼Œæ˜¯ä¸€ä¸ªç›¸å½“æ¸©æš–çš„æ•…äº‹ï¼›ã€Šæ¯”æµ·æ›´æ·±ã€‹å…¶å®æ•…äº‹æ€§ç›¸å¯¹æ²¡æœ‰é‚£ä¹ˆå¼ºï¼Œæ¯”è¾ƒåå‘ä¹‹å‰çš„ä½œå“ï¼Œè®²è¿°ä¸€ä¸ªè‡ªç§°å°è¯´å®¶ä½“éªŒç”Ÿæ´»çš„ç§å®¶ä¾¦æ¢ç”±äºèµŒåšç¦»å©šä¹‹åä¾ç„¶å¯¹å¦»å­å’Œå­©å­å‰²èˆä¸ä¸‹æƒ³è¦æŒ½å›çš„æ•…äº‹ï¼Œå½±ç‰‡çš„é«˜æ½®è½æ ¹äºå°é£çš„å¤œæ™šè‰¯å¤šï¼ˆå¯¼æ¼”å¾ˆå¤šä¸åŒå½±ç‰‡ç”·ä¸»äººå…¬éƒ½å«è¿™ä¸ªåå­—ï¼‰å’Œæ¯äº²ã€è‰¯å¤šå¦»å­å’Œæ¯äº²çš„è°ˆå¿ƒï¼Œè™½ç„¶æ‚”ä¸å½“åˆï¼Œä½†æ˜¯ç»ˆå½’æ˜¯å›ä¸å»çš„ã€‚æœ€åæ¯äº²(æ ‘æœ¨å¸Œæ—æ‰®æ¼”)è¯´çš„è¿™å¥è¯ä¸ç¦è®©äººå”å˜˜æ„Ÿæ…¨ã€‚\næ´»äº†è¿™ä¹ˆå¤šå¹´ï¼Œæˆ‘è¿˜ä»æ¥æ²¡æœ‰è¿™ä¹ˆä¸€ä¸ªäººï¼Œå¯ä»¥è¯´æˆ‘çˆ±ä»–æ¯”æµ·æ›´æ·±â€¦\nå‰æ®µæ—¶é—´åˆçœ‹äº†æ˜¯æè£•å’Œå¯¼æ¼”çš„ã€Šå°å·å®¶æ—ã€‹ï¼Œè¯¥ç‰‡è·å¾—äº†æˆ›çº³é‡‘æ£•æ¦ˆå¤§å¥–ï¼Œæœ‰å¾ˆå¤šä¹‹å‰å½±ç‰‡çš„å½±å­ã€‚æœ€è¿‘æ ‘æœ¨å¸Œæ—å¥³å£«å»ä¸–äº†,å¥¹å’Œæ˜¯æä¹Ÿæ˜¯â€œå¦‚æ¯å¦‚å­â€äº†ï¼Œæ˜¯æä¹Ÿè¯´è‡ªå·±é‡æ–°ç»å†äº†ä¸§æ¯ä¹‹ç—›ã€‚\n","permalink":"https://zhxin.xyz/post/%E5%85%B3%E4%BA%8E%E6%98%AF%E6%9E%9D%E8%A3%95%E5%92%8C/","summary":"åº”è¯¥æ˜¯å¤§äºŒæˆ–è€…å¤§ä¸‰çš„æ—¶å€™ç¬¬ä¸€æ¬¡çœ‹æ˜¯æè£•å’Œå¯¼æ¼”çš„ç”µå½±ã€Šæ— äººçŸ¥æ™“ã€‹ã€‚å½“æ—¶å¥½åƒæ˜¯çœ‹äº†ä¸€ç¯‡æ–‡ç« ï¼Œä»‹ç»è¯´æŸ³ä¹ä¼˜å¼¥å‡­å€Ÿè¯¥ç‰‡å‡»è´¥ã€ŠèŠ±æ ·å¹´åã€‹æ¢æœä¼Ÿæˆä¸ºäº†æˆ›","title":"å…³äºæ˜¯æè£•å’Œ"},{"content":"28å²ã€å•èº«ã€æ— ä¸šã€æ³¡å›¾ä¹¦é¦†ï¼Œ è¿½å‰§çœ‹åˆ°è¿™å‡ ä¸ªå…³é”®è¯çš„æ—¶å€™è‡ªå·±éš¾å…ä¼šå¿ƒä¸€ç¬‘ï¼Œå› ä¸ºè¿™å‡ ä¸ªæ ‡ç­¾å¯ä»¥å®Œç¾å¥—åœ¨å½“ä¸‹çš„è‡ªå·±èº«ä¸Šã€‚ æ¯•ä¸šåçš„ç¬¬ä¸€ä»½å·¥ä½œåœ¨åšæŒäº†å‡ å¹´ä¹‹åè¿˜æ˜¯æœ€è¿‘æå‡ºäº†ç¦»èŒã€‚è‡ªç„¶æ²¡æœ‰å‰§ä¸­é‚£æ ·æå…·æˆå‰§å†²çªçš„æ„å¤–ä¼šè®©ä½ çªç„¶å†³å®šç¦»èŒæ¥å¼€å§‹æ–°çš„ç”Ÿæ´»ï¼Œç°å®ä¸­çš„èŒåœºåªä¼šè®©ä½ åœ¨ä¸€çœ¼çœ‹å¾—åˆ°å¤´çš„æ—¥å­ä¸­ç²¾ç¥è¢«ä¸€ç‚¹ç‚¹æ‘§æ®‹ç›´åˆ°æ¿’ä¸´å´©æºƒã€‚28å²æ˜¯å¾ˆå°´å°¬çš„å¹´é¾„ï¼Œæ˜æ˜æ„Ÿè§‰æ­£å¹´è½»ï¼Œæ˜¯å­©ææ—¶å‘å¾€çš„èƒ½å¤Ÿè‡ªç”±ç‹¬ç«‹ã€å¤©é«˜ä»»é¸Ÿé£çš„æ—¶å€™ï¼Œä½†æ˜¯ç°å®å´æ˜¯ä»æœªæœ‰è¿‡çš„è¿·èŒ«ï¼Œæ¯”å¤§å­¦åˆšæ¯•ä¸šçš„æ—¶å€™æœ‰è¿‡ä¹‹è€Œæ— ä¸åŠã€‚å‡ªåœ¨å›¾ä¹¦é¦†ä¸­å‘†åˆ°æœ€åä¹Ÿå†™ä¸å‡ºæ„¿æœ›æ¸…å•ä¸­çš„ä¸€é¡¹ï¼Œåæ­£ä¸çŸ¥é“åˆ«äººæ€æ ·ï¼Œè‡ªå·±å´æ˜¯çœŸçš„ä¸çŸ¥é“å¹²ä»€ä¹ˆçš„ï¼Œåªæ˜¯è¢«åŠ¨çš„é€‰äº†ä¸“ä¸šï¼Œæ¯•ä¸šåä»äº‹ä¸“ä¸šç›¸å…³çš„å·¥ä½œã€‚ä¹Ÿä¸æ˜¯æ²¡æœ‰å–œæ¬¢çš„äº‹æƒ…ï¼Œä¸è¿‡ä¸ç¡®å®šå–œæ¬¢çš„äº‹æƒ…æ˜¯å¦èƒ½å¤Ÿå…»æ´»è‡ªå·±ï¼Œç”šè‡³çˆ¶æ¯å°†è‡ªå·±çš„å·¥èµ„å’Œä»–ä»¬å¬è¯´çš„åˆ«äººå®¶çš„å­©å­æ¯”è¾ƒä¹‹åä¼šè¯´ï¼šå·¥èµ„ä¹Ÿä¸é«˜å‘€â€¦ è¾èŒçš„äº‹æƒ…æ˜¯æ²¡æœ‰å‘Šè¯‰å®¶äººçš„ï¼Œæ‰€ä»¥å¾ˆæ€•æ¥åˆ°å®¶é‡Œçš„ç”µè¯ã€‚ä¸å¤ªæœ‰è¿½æ±‚å–œæ¬¢äº‹æƒ…çš„å¿µå¤´ï¼Œå› ä¸ºä¸è‡ªä¿¡ï¼Œå› ä¸ºä¸ç¡®å®šæ˜¯å¦è¶³å¤Ÿå–œæ¬¢ï¼Œé‚£ç§å¯ä»¥ä¹‰æ— åé¡¾ç ´é‡œæ²‰èˆŸçš„äººå¯èƒ½æ°¸è¿œå¯¹è¿™æ ·çš„äººæ„Ÿåˆ°æ— æ³•ç†è§£ï¼Œæˆ‘æ˜¯é‚£ç§æ°¸è¿œåœ¨è¢«ç”Ÿæ´»æ¨ç€å‘å‰èµ°çš„äººã€‚\nç¦»èŒåçš„æ—¥å­è¿˜æ˜¯æ¯”è¾ƒç„¦èºçš„ï¼Œå’Œå‡ªä¸€æ ·ï¼Œæœ‰å®³æ€•ç§¯è“„èŠ±å…‰çš„ç„¦è™‘ã€‚å¤§å¤šæ•°åŒé¾„äººæ—©å·²å®¶åº­äº‹ä¸šåŒä¸°æ”¶ï¼Œå³ä½¿ç”Ÿæ´»çš„è¾›è‹¦å¹¶æ²¡æœ‰é¥¶è¿‡è°ï¼Œä½†æ˜¯ä»–ä»¬è‡³å°‘æœ‰å¥‹æ–—çš„åŠ¨åŠ›ä¸èº«å¿ƒä¿±ç–²åçš„é¿é£æ¸¯ï¼Œè€Œè‡ªå·±å´ä¸€ç›´åœ¨æ³¥æ²¼ä¸­æŒ£æ‰ï¼Œå³ä½¿ä¸æ–­çš„æ‰‹åŠ¨è¶³æ‘‡ï¼Œä½†åœä¸‹åä¾ç„¶è¿˜æ˜¯åœ¨åŸåœ°ã€‚å‡ªè¯´è‡ªå·±ï¼šç‰¹åˆ«å–œæ¬¢SNS å¯¹äººå¯¹äº‹ä¹Ÿç‰¹åˆ«æœ‰æ‰§å¿µ å”¯ä¸€çš„å…´è¶£å°±æ˜¯èŠ‚ä¿­ï¼Œåœ¨ç¤¾ä¼šå…³ç³»ä¸­ï¼Œæ•æ„Ÿçš„äººæ€»æ˜¯é‚£ä¹ˆå®¹æ˜“æ ¼æ ¼ä¸å…¥ï¼Œæ€»æ˜¯åœ¨ä¸ºåˆ«äººè€ƒè™‘ä¸­æ‰­æ›²äº†è‡ªå·±ï¼Œåˆ«äººå°†è‡ªå·±çš„å’Œæ°”å½“åšæ²¡è„¾æ°”ã€æŠŠå¥½å¿ƒå½“åšéšä¾¿ä½¿å”¤çš„ä¹‰å·¥ï¼Œæ‰€ä»¥æ…¢æ…¢çš„æ‰“äº¤é“çš„äº‹æƒ…æ€»æ˜¯èƒ½å…å°±å…äº†ï¼Œä¹Ÿä¸æƒ³ä¸ºäº†åˆ«äººçš„çœ‹æ³•è€Œæ”¹å˜è‡ªå·±ï¼Œå¯æ˜¯åŒæ ·çš„äº‹æƒ…å†æ¬¡å‡ºç°çš„æ—¶å€™éš¾å…è¿˜æ˜¯ä¼šç ´åŠŸã€‚å‡ªå°†è‡ªå·±ç¿»èº«çš„æœºä¼šå¯„æ‰˜åˆ°å°†æ¥æŠŠå’Œæ…äºŒç»“å©šçš„æ¶ˆæ¯å‘å¸ƒSNSçš„é‚£åˆ»ï¼Œä¹Ÿè®¸å¥¹æŠŠèƒ½å¤Ÿå’Œå…«é¢ç²ç‘éšæ—¶éšåœ°æ˜¯æ°›å›´ä¸­å¿ƒçš„æ…äºŒåœ¨ä¸€èµ·å½“åšè‡ªå·±å”¯ä¸€ç ´é™¤å£å’æ”¹å˜ç”Ÿæ´»çš„æœºä¼šï¼Œä½†æ˜¯å‰§æƒ…çš„è®¾ç½®æ˜¯æ®‹é…·çš„æœ€ç»ˆå¯¼è‡´å‡ªæŠ›å¼ƒä¸€åˆ‡å»å¼€å§‹æ–°ç”Ÿæ´»ã€‚\nè¯´åˆ°è¿™ä¸ªæ…äºŒæ„Ÿè§‰ä»–æœ‰ç‚¹å¯¹å‡ªç²¾ç¥è™å¾…çš„æ„æ€ï¼Œä¸€å¼€å§‹çœ‹åˆ°æ…äºŒçš„æ ‡å‡†åæ´¾è¡¨ç°æ„Ÿè§‰é«˜æ¡¥ä¸€ç”Ÿè¿™æ¬¡åœ¨å‰§ä¸­åº”è¯¥æ˜¯æ‰“é…±æ²¹çš„å§ï¼Œè°çŸ¥é“åæ¥ç¼–å‰§ç»™æ…äºŒå¼ºè¡Œâ€˜æ´—ç™½â€™ï¼šå¯¹å‡ªæ‰€åšçš„ä¸€åˆ‡åªæ˜¯ç”±äºä¸ä¼šè¡¨è¾¾çˆ±ã€‚ç¼–å‰§ä¹Ÿå†™å‡ºäº†ç±»ä¼¼ç”·å¥³ä¹‹é—´æ‚²å‰§çš„å¯¼ç«ç´¢æ€»æ˜¯å› ä¸ºè¯è¯´çš„ä¸åˆ°ä½è¿™ç§æ—¥å‰§é‡‘å¥ã€‚æ…äºŒåœ¨å‰§ä¸­å¤„å¤„æ‰“å‡»å‡ªçš„è‡ªå°Šå¿ƒï¼Œä¸ç®¡æœ‰å¿ƒè¿˜æ˜¯æ— æ„ã€‚ã€Šå†·æš´åŠ›ã€‹ä¸­æœ‰è¿™æ ·ä¸€æ®µæè¿°ç²¾ç¥è™å¾…:\næ–½è™è€…å´æ˜¯ä»¥ä¸€è´¯çš„é‚ªæ¶æ–¹å¼è™å¾…åˆ«äººï¼Œå¹¶å›ºæ‰§åœ°ç»´æŒè¿™ç§ç‰¹å®šå½¢å¼çš„å…³ç³»â€¦è¿™ç§äººä¸ºæ»¡è¶³è‡ªèº«å¯¹è·å¾—å€¾æ…•å’Œè‚¯å®šçš„æ— å°½éœ€æ±‚ï¼Œä¸€å®šè¦ä»¥è´¬æŠ‘ä»–äººçš„æ–¹å¼æ¥ç»´æŠ¤è‡ªå°Šï¼Œç»§è€Œæ¡æœ‰æƒåŠ›ã€‚ç”±äºä»–ä»¬ä¸åœ¨ä¹ä¸ä»–äººçš„å…³ç³»ï¼Œä¹Ÿå°±ä¸ä¼šæœ‰åŒç†å¿ƒï¼Œä¹Ÿä¸ä¼šæ‡‚å¾—å°Šé‡åˆ«äººã€‚\næ€»ä¹‹æ„Ÿè§‰æ…äºŒè¿™ä¸ªè§’è‰²å†™çš„æœ‰ç‚¹é—®é¢˜ï¼Œä¸æ˜¯é«˜æ¡¥ä¸€ç”Ÿæ¼”çš„ä¸å¥½ï¼Œä¹‹å‰çœ‹ä»–æ¼”çš„å››é‡å¥å°±æŒºå¥½çš„ã€‚ å¤§é¾„æœªå©šç”·å¥³é’å¹´æ„Ÿè§‰æ˜¯ä¸ªå®¹æ˜“åœ¨å¾®åšçŸ¥ä¹è¿™æ ·çš„åœ°æ–¹å¼•èµ·çƒ­è®®çš„è¯é¢˜ï¼Œç”šè‡³æ‹¿å¥³åšå£«è¿™æ ·å‰å®³çš„äººæ‹¿æ¥è°ƒä¾ƒï¼Œè²Œä¼¼æ²¡æœ‰ç»“å©šçš„äººç”Ÿå°±æ˜¯å¤±è´¥çš„ã€‚æœ‰äººè§‰å¾—ç»“å©šéœ€è¦çš„æ˜¯çˆ±ï¼Œæœ‰çš„è§‰å¾—æ˜¯é—¨å½“æˆ·å¯¹ï¼Œæœ‰çš„è§‰å¾—æˆ¿å­è½¦å­ä¸èƒ½å°‘ï¼Œæœ‰çš„è§‰å¾—æœ‰æƒ…é¥®æ°´é¥±ï¼Œå¯¹æ­¤æˆ‘ä¹Ÿæ²¡æœ‰èƒ½åŠ›è·³è„±å‡ºæ¥è¯´äº›å…äºä¸–ä¿—äº¦æˆ–ç†æƒ³è¶…è„±çš„è¯ã€‚å¾ˆé•¿ä¸€æ®µæ—¶é—´åŒ…æ‹¬ç°åœ¨éƒ½æ€€ç–‘è‡ªå·±æ˜¯å¦æœ‰çˆ±çš„èƒ½åŠ›ï¼Œå°±æ˜¯ä¸æ¸…æ¥šåˆ°ä»€ä¹ˆç¨‹åº¦æ‰èƒ½å¤Ÿè¯´æ˜¯çˆ±ï¼Œç›®å‰åªçŸ¥é“ä»€ä¹ˆæ˜¯å–œæ¬¢ï¼Œæ­‡æ–¯åº•é‡Œæ˜¯æ°¸è¿œåšä¸åˆ°çš„ï¼Œå¯¹æ¿€çƒˆè€Œåˆæç«¯çš„æ‹ä¾£ä»¬å§‹ç»ˆæ— æ³•ç†è§£ã€‚åˆ°äº†å¥”ä¸‰çš„å¹´çºªå³ä½¿è‡ªå·±è§‰å¾—ç»“å©šä¸ç€æ€¥ï¼Œçˆ¶æ¯å‚¬å©šä¹Ÿèƒ½æå¾—ä½ å´©æºƒï¼Œç›¸äº²è¿™ç§æ´»åŠ¨å¯¹æ•æ„Ÿè€Œç¤¾æçš„äººæ¥è¯´ç®€ç›´è‡´å‘½ï¼Œæ‰€ä»¥åªèƒ½éª—çˆ¶æ¯è¯´å·²ç»æœ‰å¯¹è±¡åœ¨è°ˆæ¥æ¢å¾—ç‰‡åˆ»çš„å®‰é™ï¼Œç»§è€Œåœ¨ç”Ÿæ´»çš„æ³¥æ²¼ä¸­ç»§ç»­æŒ£æ‰ã€‚å¯¹äºå©šå§»è¦ä¹ˆæ˜¯è¿‡äºç†æƒ³è¦ä¹ˆæ˜¯è¿‡äºæ¶ˆæã€‚ä¹Ÿè®¸æœ€ç»ˆè¿˜æ˜¯å¾—å’Œèƒ½å¤Ÿæ¸©æš–æ…°è—‰åˆ°è‡ªå·±çš„äººåœ¨ä¸€èµ·æ‰èˆ’æœå§ï¼Œä¹Ÿè®¸è¿™åˆæ˜¯ç†æƒ³åŒ–äº†ã€‚åœ¨ç°å®æµ®èºçš„ç¤¾ä¼šä¸­æœŸæœ›é€šè¿‡è¿™æ ·çš„æ–­èˆç¦»æ¥è·å¾—æ–°ç”Ÿæ´»çš„åŠªåŠ›ç»ˆå½’æ˜¯å¾’åŠ³ï¼Œèµ·ç æˆ‘è§‰å¾—è‡ªå·±è¿™æ®µç¦»èŒä¼‘å‡å¹¶ä¸ä¼šæ”¹å˜ä»€ä¹ˆï¼Œä¸è¿‡å‰§ä¸­åº”è¯¥æ˜¯åœ†æ»¡ç»“å±€ã€‚å†™äº†è¿™ç¯‡æ‚ä¹±æ— ç« çš„ä¸œè¥¿åªæ˜¯å› ä¸ºè¿™éƒ¨å‰§(åªçœ‹äº†å‰ä¸¤é›†)å’Œè‡ªå·±ç›®å‰çš„çŠ¶æ€æœ‰æ‰€å‘¼åº”è€Œå·²ï¼Œå¯èƒ½è¿™éƒ¨å‰§è¿™ä¹ˆå—å…³æ³¨ä¹Ÿæ˜¯å› ä¸ºè§¦åŠ¨äº†å½“å‰å¥”ä¸‰è·¯ä¸Šçš„äººä»¬çš„ä¸€äº›æ•æ„Ÿç¥ç»å§ï¼Œå°±è¿™æ ·å§ï¼Œæ„Ÿè°¢å¬æˆ‘å•°å—¦ï¼Œå¸Œæœ›å¤§å®¶å¹¸ç¦ã€‚\n","permalink":"https://zhxin.xyz/post/%E4%B8%8D%E4%BC%9A%E5%88%B0%E6%9D%A5%E7%9A%84%E6%96%B0%E7%94%9F%E6%B4%BB/","summary":"28å²ã€å•èº«ã€æ— ä¸šã€æ³¡å›¾ä¹¦é¦†ï¼Œ è¿½å‰§çœ‹åˆ°è¿™å‡ ä¸ªå…³é”®è¯çš„æ—¶å€™è‡ªå·±éš¾å…ä¼šå¿ƒä¸€ç¬‘ï¼Œå› ä¸ºè¿™å‡ ä¸ªæ ‡ç­¾å¯ä»¥å®Œç¾å¥—åœ¨å½“ä¸‹çš„è‡ªå·±èº«ä¸Šã€‚ æ¯•ä¸šåçš„ç¬¬ä¸€ä»½å·¥ä½œåœ¨åšæŒ","title":"ä¸ä¼šåˆ°æ¥çš„æ–°ç”Ÿæ´»"}]